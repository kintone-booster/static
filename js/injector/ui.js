/*
* FileName "ui.js"
* Version: 1.0.0
* Copyright (c) 2023 Pandafirm LLC
* Distributed under the terms of the GNU Lesser General Public License.
* https://opensource.org/licenses/LGPL-2.1
*/
'use strict';window.KintoneBoosterAttachment=class{constructor(){}show(f,l=!0){kb.file.download(f).then(n=>{try{var k=()=>{var c=kb.create("a").css({display:"none"}).attr("href",kb.field.objectUrl(n,f.contentType)).attr("target","_blank").attr("download",f.name);kb.elm("body").append(c);c.click();document.body.removeChild(c)};switch(f.contentType){case "application/javascript":fetch(new Request(kb.field.objectUrl(n,f.contentType))).then(c=>c.text()).then(c=>{var e=c.split("\n");kb.create("div").append((a=>
{e.each((g,h)=>a.append(kb.create("code").css({display:"block"}).text(g)));return a})(kb.create("pre"))).popup("full","full",l?[{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAFN++nkAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA1FJREFUeNpiYKA66J8y8T8ynwmfJE6dQHYAjM9CtAlIihJIcjRAANHD71hdDxIA+RVdAbKf1wMFqeRXgACiqdcbQBiXPBMB/fVQTLxmoG3riRHDlXwWgIjCnHxGJOkPMHmYOCMx0QwDaIZRBgACaDgiYMDtxydPKJE4UKIZL8AVzwZA6jySkCEwji8QtBmoUQBIgbAhTCOIDxXHX4DgSl3Y5CjyMwspaRuvn6EJfwEOtQtIyhiEEsnAAYAAGkV0A4wUFDH/KSmPmYaEj4nJpcT6niQfQw01xCFtSEqQMxLwYT+QKsDmI6RyGV4eYwmRCUC5QpIsRjJEEaj5ARmJTwFI3ccV/CxEmHEfS2svEWjYArQG33yKi3ooCAQ1MXHIzQdaRqxFjtRI1aDgA5X+ClikQdHhSE60jAKaAoAAGkWjYBSgtF8pacOyUGC3AyUOH7Cmz8izmJGUxEREvB4AVouOtGhlvod2Y7GBD0BLBWnWoMdhOUmWEh3HoDYVrKkDteADNktBaogdcGMksZnTCLSkAcnnDEiWgsTriW0KMRKZkEDd8kQiQwcUMgmEEhwLgVKJ5LiDOjARKS04kFNkCkAb9h+gwXaBgG8NoNEjQK2yGmTQeWjD/gCozQ10xAekkaL1pJbduCz+gMfVIAve4x1LxjSLuOwEjdcNVCgZN+BKI4xEpFKi4w3JhwTTA6lFJqjL2o8rQQMtm0CPFgjesfhRMAoGDAAEaNdqbxCEgWhjGKAjMAKbyAg6ATM4gWECGQE2cBRGcAS5eI1VGvt110C8F/hDSNvX69217yqPQCAQbBnF69iuikbJevrh3ywshIUwrf82Md93E7QSjpXJR81NRelE4ixEi6alQOKsRMkI4+XCo/rU7wxAiBo9xFdEsU1X0XhY3sluk5VwhHo2q5c+dTHKm8Pi3fL2LotiP6DAAvHa09ddWQofNWHXvQ8YMMh6Y2iniStJ4wTARDWpuzWKtNTgkm6ZQ4FxnawUVhEOpv26kDFblp8jLFlblqypZ61itAgMFtTVqyVkP9C3J/UWwM3q0KoAYglDUeOW0Z/GaH4i5nEO/THneh7r0vNkgGhXYdt4YBWRKoiNmHeHPe60uh++any7595pCQQCgWDLeALGLWqyLWBxZQAAAABJRU5ErkJggg==",
handler:k}]:[]).show()});break;case "application/json":fetch(new Request(kb.field.objectUrl(n,f.contentType))).then(c=>c.text()).then(c=>{kb.create("div").html(c.replace(/\n/g,"<br>")).popup("full","full",l?[{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAFN++nkAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA1FJREFUeNpiYKA66J8y8T8ynwmfJE6dQHYAjM9CtAlIihJIcjRAANHD71hdDxIA+RVdAbKf1wMFqeRXgACiqdcbQBiXPBMB/fVQTLxmoG3riRHDlXwWgIjCnHxGJOkPMHmYOCMx0QwDaIZRBgACaDgiYMDtxydPKJE4UKIZL8AVzwZA6jySkCEwji8QtBmoUQBIgbAhTCOIDxXHX4DgSl3Y5CjyMwspaRuvn6EJfwEOtQtIyhiEEsnAAYAAGkV0A4wUFDH/KSmPmYaEj4nJpcT6niQfQw01xCFtSEqQMxLwYT+QKsDmI6RyGV4eYwmRCUC5QpIsRjJEEaj5ARmJTwFI3ccV/CxEmHEfS2svEWjYArQG33yKi3ooCAQ1MXHIzQdaRqxFjtRI1aDgA5X+ClikQdHhSE60jAKaAoAAGkWjYBSgtF8pacOyUGC3AyUOH7Cmz8izmJGUxEREvB4AVouOtGhlvod2Y7GBD0BLBWnWoMdhOUmWEh3HoDYVrKkDteADNktBaogdcGMksZnTCLSkAcnnDEiWgsTriW0KMRKZkEDd8kQiQwcUMgmEEhwLgVKJ5LiDOjARKS04kFNkCkAb9h+gwXaBgG8NoNEjQK2yGmTQeWjD/gCozQ10xAekkaL1pJbduCz+gMfVIAve4x1LxjSLuOwEjdcNVCgZN+BKI4xEpFKi4w3JhwTTA6lFJqjL2o8rQQMtm0CPFgjesfhRMAoGDAAEaNdqbxCEgWhjGKAjMAKbyAg6ATM4gWECGQE2cBRGcAS5eI1VGvt110C8F/hDSNvX69217yqPQCAQbBnF69iuikbJevrh3ywshIUwrf82Md93E7QSjpXJR81NRelE4ixEi6alQOKsRMkI4+XCo/rU7wxAiBo9xFdEsU1X0XhY3sluk5VwhHo2q5c+dTHKm8Pi3fL2LotiP6DAAvHa09ddWQofNWHXvQ8YMMh6Y2iniStJ4wTARDWpuzWKtNTgkm6ZQ4FxnawUVhEOpv26kDFblp8jLFlblqypZ61itAgMFtTVqyVkP9C3J/UWwM3q0KoAYglDUeOW0Z/GaH4i5nEO/THneh7r0vNkgGhXYdt4YBWRKoiNmHeHPe60uh++any7595pCQQCgWDLeALGLWqyLWBxZQAAAABJRU5ErkJggg==",
handler:k}]:[]).show()});break;case "application/pdf":"other"!=kb.device()?window.open(kb.field.objectUrl(n,f.contentType)):kb.create("iframe").css({border:"none",height:"100%",outline:"none",width:"100%"}).attr("src",kb.field.objectUrl(n,f.contentType)+"#toolbar=0&navpanes=0").popup("full","full",l?[{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAFN++nkAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA1FJREFUeNpiYKA66J8y8T8ynwmfJE6dQHYAjM9CtAlIihJIcjRAANHD71hdDxIA+RVdAbKf1wMFqeRXgACiqdcbQBiXPBMB/fVQTLxmoG3riRHDlXwWgIjCnHxGJOkPMHmYOCMx0QwDaIZRBgACaDgiYMDtxydPKJE4UKIZL8AVzwZA6jySkCEwji8QtBmoUQBIgbAhTCOIDxXHX4DgSl3Y5CjyMwspaRuvn6EJfwEOtQtIyhiEEsnAAYAAGkV0A4wUFDH/KSmPmYaEj4nJpcT6niQfQw01xCFtSEqQMxLwYT+QKsDmI6RyGV4eYwmRCUC5QpIsRjJEEaj5ARmJTwFI3ccV/CxEmHEfS2svEWjYArQG33yKi3ooCAQ1MXHIzQdaRqxFjtRI1aDgA5X+ClikQdHhSE60jAKaAoAAGkWjYBSgtF8pacOyUGC3AyUOH7Cmz8izmJGUxEREvB4AVouOtGhlvod2Y7GBD0BLBWnWoMdhOUmWEh3HoDYVrKkDteADNktBaogdcGMksZnTCLSkAcnnDEiWgsTriW0KMRKZkEDd8kQiQwcUMgmEEhwLgVKJ5LiDOjARKS04kFNkCkAb9h+gwXaBgG8NoNEjQK2yGmTQeWjD/gCozQ10xAekkaL1pJbduCz+gMfVIAve4x1LxjSLuOwEjdcNVCgZN+BKI4xEpFKi4w3JhwTTA6lFJqjL2o8rQQMtm0CPFgjesfhRMAoGDAAEaNdqbxCEgWhjGKAjMAKbyAg6ATM4gWECGQE2cBRGcAS5eI1VGvt110C8F/hDSNvX69217yqPQCAQbBnF69iuikbJevrh3ywshIUwrf82Md93E7QSjpXJR81NRelE4ixEi6alQOKsRMkI4+XCo/rU7wxAiBo9xFdEsU1X0XhY3sluk5VwhHo2q5c+dTHKm8Pi3fL2LotiP6DAAvHa09ddWQofNWHXvQ8YMMh6Y2iniStJ4wTARDWpuzWKtNTgkm6ZQ4FxnawUVhEOpv26kDFblp8jLFlblqypZ61itAgMFtTVqyVkP9C3J/UWwM3q0KoAYglDUeOW0Z/GaH4i5nEO/THneh7r0vNkgGhXYdt4YBWRKoiNmHeHPe60uh++any7595pCQQCgWDLeALGLWqyLWBxZQAAAABJRU5ErkJggg==",
handler:k}]:[]).show();break;case "audio/mpeg":case "audio/x-m4a":kb.create("audio").css({outline:"none"}).attr("controls","controls").attr("src",kb.field.objectUrl(n,f.contentType)).popup(null,null,l?[{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAFN++nkAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA1FJREFUeNpiYKA66J8y8T8ynwmfJE6dQHYAjM9CtAlIihJIcjRAANHD71hdDxIA+RVdAbKf1wMFqeRXgACiqdcbQBiXPBMB/fVQTLxmoG3riRHDlXwWgIjCnHxGJOkPMHmYOCMx0QwDaIZRBgACaDgiYMDtxydPKJE4UKIZL8AVzwZA6jySkCEwji8QtBmoUQBIgbAhTCOIDxXHX4DgSl3Y5CjyMwspaRuvn6EJfwEOtQtIyhiEEsnAAYAAGkV0A4wUFDH/KSmPmYaEj4nJpcT6niQfQw01xCFtSEqQMxLwYT+QKsDmI6RyGV4eYwmRCUC5QpIsRjJEEaj5ARmJTwFI3ccV/CxEmHEfS2svEWjYArQG33yKi3ooCAQ1MXHIzQdaRqxFjtRI1aDgA5X+ClikQdHhSE60jAKaAoAAGkWjYBSgtF8pacOyUGC3AyUOH7Cmz8izmJGUxEREvB4AVouOtGhlvod2Y7GBD0BLBWnWoMdhOUmWEh3HoDYVrKkDteADNktBaogdcGMksZnTCLSkAcnnDEiWgsTriW0KMRKZkEDd8kQiQwcUMgmEEhwLgVKJ5LiDOjARKS04kFNkCkAb9h+gwXaBgG8NoNEjQK2yGmTQeWjD/gCozQ10xAekkaL1pJbduCz+gMfVIAve4x1LxjSLuOwEjdcNVCgZN+BKI4xEpFKi4w3JhwTTA6lFJqjL2o8rQQMtm0CPFgjesfhRMAoGDAAEaNdqbxCEgWhjGKAjMAKbyAg6ATM4gWECGQE2cBRGcAS5eI1VGvt110C8F/hDSNvX69217yqPQCAQbBnF69iuikbJevrh3ywshIUwrf82Md93E7QSjpXJR81NRelE4ixEi6alQOKsRMkI4+XCo/rU7wxAiBo9xFdEsU1X0XhY3sluk5VwhHo2q5c+dTHKm8Pi3fL2LotiP6DAAvHa09ddWQofNWHXvQ8YMMh6Y2iniStJ4wTARDWpuzWKtNTgkm6ZQ4FxnawUVhEOpv26kDFblp8jLFlblqypZ61itAgMFtTVqyVkP9C3J/UWwM3q0KoAYglDUeOW0Z/GaH4i5nEO/THneh7r0vNkgGhXYdt4YBWRKoiNmHeHPe60uh++any7595pCQQCgWDLeALGLWqyLWBxZQAAAABJRU5ErkJggg==",
handler:k}]:[]).show();break;case "image/bmp":case "image/gif":case "image/jpeg":case "image/png":kb.create("img").css({maxHeight:"calc(100vh - 4em)",maxWidth:"calc(100vw - 2em)"}).attr("src",kb.field.objectUrl(n,f.contentType)).popup(null,null,l?[{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAFN++nkAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA1FJREFUeNpiYKA66J8y8T8ynwmfJE6dQHYAjM9CtAlIihJIcjRAANHD71hdDxIA+RVdAbKf1wMFqeRXgACiqdcbQBiXPBMB/fVQTLxmoG3riRHDlXwWgIjCnHxGJOkPMHmYOCMx0QwDaIZRBgACaDgiYMDtxydPKJE4UKIZL8AVzwZA6jySkCEwji8QtBmoUQBIgbAhTCOIDxXHX4DgSl3Y5CjyMwspaRuvn6EJfwEOtQtIyhiEEsnAAYAAGkV0A4wUFDH/KSmPmYaEj4nJpcT6niQfQw01xCFtSEqQMxLwYT+QKsDmI6RyGV4eYwmRCUC5QpIsRjJEEaj5ARmJTwFI3ccV/CxEmHEfS2svEWjYArQG33yKi3ooCAQ1MXHIzQdaRqxFjtRI1aDgA5X+ClikQdHhSE60jAKaAoAAGkWjYBSgtF8pacOyUGC3AyUOH7Cmz8izmJGUxEREvB4AVouOtGhlvod2Y7GBD0BLBWnWoMdhOUmWEh3HoDYVrKkDteADNktBaogdcGMksZnTCLSkAcnnDEiWgsTriW0KMRKZkEDd8kQiQwcUMgmEEhwLgVKJ5LiDOjARKS04kFNkCkAb9h+gwXaBgG8NoNEjQK2yGmTQeWjD/gCozQ10xAekkaL1pJbduCz+gMfVIAve4x1LxjSLuOwEjdcNVCgZN+BKI4xEpFKi4w3JhwTTA6lFJqjL2o8rQQMtm0CPFgjesfhRMAoGDAAEaNdqbxCEgWhjGKAjMAKbyAg6ATM4gWECGQE2cBRGcAS5eI1VGvt110C8F/hDSNvX69217yqPQCAQbBnF69iuikbJevrh3ywshIUwrf82Md93E7QSjpXJR81NRelE4ixEi6alQOKsRMkI4+XCo/rU7wxAiBo9xFdEsU1X0XhY3sluk5VwhHo2q5c+dTHKm8Pi3fL2LotiP6DAAvHa09ddWQofNWHXvQ8YMMh6Y2iniStJ4wTARDWpuzWKtNTgkm6ZQ4FxnawUVhEOpv26kDFblp8jLFlblqypZ61itAgMFtTVqyVkP9C3J/UWwM3q0KoAYglDUeOW0Z/GaH4i5nEO/THneh7r0vNkgGhXYdt4YBWRKoiNmHeHPe60uh++any7595pCQQCgWDLeALGLWqyLWBxZQAAAABJRU5ErkJggg==",
handler:k}]:[]).show();break;case "text/plain":case "text/css":fetch(new Request(kb.field.objectUrl(n,f.contentType))).then(c=>c.text()).then(c=>{kb.create("div").html(c.replace(/\n/g,"<br>")).popup("full","full",l?[{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAFN++nkAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA1FJREFUeNpiYKA66J8y8T8ynwmfJE6dQHYAjM9CtAlIihJIcjRAANHD71hdDxIA+RVdAbKf1wMFqeRXgACiqdcbQBiXPBMB/fVQTLxmoG3riRHDlXwWgIjCnHxGJOkPMHmYOCMx0QwDaIZRBgACaDgiYMDtxydPKJE4UKIZL8AVzwZA6jySkCEwji8QtBmoUQBIgbAhTCOIDxXHX4DgSl3Y5CjyMwspaRuvn6EJfwEOtQtIyhiEEsnAAYAAGkV0A4wUFDH/KSmPmYaEj4nJpcT6niQfQw01xCFtSEqQMxLwYT+QKsDmI6RyGV4eYwmRCUC5QpIsRjJEEaj5ARmJTwFI3ccV/CxEmHEfS2svEWjYArQG33yKi3ooCAQ1MXHIzQdaRqxFjtRI1aDgA5X+ClikQdHhSE60jAKaAoAAGkWjYBSgtF8pacOyUGC3AyUOH7Cmz8izmJGUxEREvB4AVouOtGhlvod2Y7GBD0BLBWnWoMdhOUmWEh3HoDYVrKkDteADNktBaogdcGMksZnTCLSkAcnnDEiWgsTriW0KMRKZkEDd8kQiQwcUMgmEEhwLgVKJ5LiDOjARKS04kFNkCkAb9h+gwXaBgG8NoNEjQK2yGmTQeWjD/gCozQ10xAekkaL1pJbduCz+gMfVIAve4x1LxjSLuOwEjdcNVCgZN+BKI4xEpFKi4w3JhwTTA6lFJqjL2o8rQQMtm0CPFgjesfhRMAoGDAAEaNdqbxCEgWhjGKAjMAKbyAg6ATM4gWECGQE2cBRGcAS5eI1VGvt110C8F/hDSNvX69217yqPQCAQbBnF69iuikbJevrh3ywshIUwrf82Md93E7QSjpXJR81NRelE4ixEi6alQOKsRMkI4+XCo/rU7wxAiBo9xFdEsU1X0XhY3sluk5VwhHo2q5c+dTHKm8Pi3fL2LotiP6DAAvHa09ddWQofNWHXvQ8YMMh6Y2iniStJ4wTARDWpuzWKtNTgkm6ZQ4FxnawUVhEOpv26kDFblp8jLFlblqypZ61itAgMFtTVqyVkP9C3J/UWwM3q0KoAYglDUeOW0Z/GaH4i5nEO/THneh7r0vNkgGhXYdt4YBWRKoiNmHeHPe60uh++any7595pCQQCgWDLeALGLWqyLWBxZQAAAABJRU5ErkJggg==",
handler:k}]:[]).show()});break;case "text/csv":fetch(new Request(kb.field.objectUrl(n,f.contentType))).then(c=>c.text()).then(c=>{var e=c.parseCSV();0!=e.length&&(a=>{e.each((g,h)=>{a.append((m=>{g.each((p,u)=>m.append(kb.create("td").css({padding:"0.25em"}).html(p.replace(/\n/g,"<br>"))));return m})(kb.create("tr")))});return a})(kb.create("table")).popup(null,"full",l?[{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAFN++nkAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA1FJREFUeNpiYKA66J8y8T8ynwmfJE6dQHYAjM9CtAlIihJIcjRAANHD71hdDxIA+RVdAbKf1wMFqeRXgACiqdcbQBiXPBMB/fVQTLxmoG3riRHDlXwWgIjCnHxGJOkPMHmYOCMx0QwDaIZRBgACaDgiYMDtxydPKJE4UKIZL8AVzwZA6jySkCEwji8QtBmoUQBIgbAhTCOIDxXHX4DgSl3Y5CjyMwspaRuvn6EJfwEOtQtIyhiEEsnAAYAAGkV0A4wUFDH/KSmPmYaEj4nJpcT6niQfQw01xCFtSEqQMxLwYT+QKsDmI6RyGV4eYwmRCUC5QpIsRjJEEaj5ARmJTwFI3ccV/CxEmHEfS2svEWjYArQG33yKi3ooCAQ1MXHIzQdaRqxFjtRI1aDgA5X+ClikQdHhSE60jAKaAoAAGkWjYBSgtF8pacOyUGC3AyUOH7Cmz8izmJGUxEREvB4AVouOtGhlvod2Y7GBD0BLBWnWoMdhOUmWEh3HoDYVrKkDteADNktBaogdcGMksZnTCLSkAcnnDEiWgsTriW0KMRKZkEDd8kQiQwcUMgmEEhwLgVKJ5LiDOjARKS04kFNkCkAb9h+gwXaBgG8NoNEjQK2yGmTQeWjD/gCozQ10xAekkaL1pJbduCz+gMfVIAve4x1LxjSLuOwEjdcNVCgZN+BKI4xEpFKi4w3JhwTTA6lFJqjL2o8rQQMtm0CPFgjesfhRMAoGDAAEaNdqbxCEgWhjGKAjMAKbyAg6ATM4gWECGQE2cBRGcAS5eI1VGvt110C8F/hDSNvX69217yqPQCAQbBnF69iuikbJevrh3ywshIUwrf82Md93E7QSjpXJR81NRelE4ixEi6alQOKsRMkI4+XCo/rU7wxAiBo9xFdEsU1X0XhY3sluk5VwhHo2q5c+dTHKm8Pi3fL2LotiP6DAAvHa09ddWQofNWHXvQ8YMMh6Y2iniStJ4wTARDWpuzWKtNTgkm6ZQ4FxnawUVhEOpv26kDFblp8jLFlblqypZ61itAgMFtTVqyVkP9C3J/UWwM3q0KoAYglDUeOW0Z/GaH4i5nEO/THneh7r0vNkgGhXYdt4YBWRKoiNmHeHPe60uh++any7595pCQQCgWDLeALGLWqyLWBxZQAAAABJRU5ErkJggg==",
handler:k}]:[]).show()});break;case "video/mp4":case "video/mpeg":kb.create("video").css({maxHeight:"calc(100vh - 4em)",maxWidth:"calc(100vw - 2em)",outline:"none"}).attr("controls","controls").attr("src",kb.field.objectUrl(n,f.contentType)).popup(null,null,l?[{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAFN++nkAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA1FJREFUeNpiYKA66J8y8T8ynwmfJE6dQHYAjM9CtAlIihJIcjRAANHD71hdDxIA+RVdAbKf1wMFqeRXgACiqdcbQBiXPBMB/fVQTLxmoG3riRHDlXwWgIjCnHxGJOkPMHmYOCMx0QwDaIZRBgACaDgiYMDtxydPKJE4UKIZL8AVzwZA6jySkCEwji8QtBmoUQBIgbAhTCOIDxXHX4DgSl3Y5CjyMwspaRuvn6EJfwEOtQtIyhiEEsnAAYAAGkV0A4wUFDH/KSmPmYaEj4nJpcT6niQfQw01xCFtSEqQMxLwYT+QKsDmI6RyGV4eYwmRCUC5QpIsRjJEEaj5ARmJTwFI3ccV/CxEmHEfS2svEWjYArQG33yKi3ooCAQ1MXHIzQdaRqxFjtRI1aDgA5X+ClikQdHhSE60jAKaAoAAGkWjYBSgtF8pacOyUGC3AyUOH7Cmz8izmJGUxEREvB4AVouOtGhlvod2Y7GBD0BLBWnWoMdhOUmWEh3HoDYVrKkDteADNktBaogdcGMksZnTCLSkAcnnDEiWgsTriW0KMRKZkEDd8kQiQwcUMgmEEhwLgVKJ5LiDOjARKS04kFNkCkAb9h+gwXaBgG8NoNEjQK2yGmTQeWjD/gCozQ10xAekkaL1pJbduCz+gMfVIAve4x1LxjSLuOwEjdcNVCgZN+BKI4xEpFKi4w3JhwTTA6lFJqjL2o8rQQMtm0CPFgjesfhRMAoGDAAEaNdqbxCEgWhjGKAjMAKbyAg6ATM4gWECGQE2cBRGcAS5eI1VGvt110C8F/hDSNvX69217yqPQCAQbBnF69iuikbJevrh3ywshIUwrf82Md93E7QSjpXJR81NRelE4ixEi6alQOKsRMkI4+XCo/rU7wxAiBo9xFdEsU1X0XhY3sluk5VwhHo2q5c+dTHKm8Pi3fL2LotiP6DAAvHa09ddWQofNWHXvQ8YMMh6Y2iniStJ4wTARDWpuzWKtNTgkm6ZQ4FxnawUVhEOpv26kDFblp8jLFlblqypZ61itAgMFtTVqyVkP9C3J/UWwM3q0KoAYglDUeOW0Z/GaH4i5nEO/THneh7r0vNkgGhXYdt4YBWRKoiNmHeHPe60uh++any7595pCQQCgWDLeALGLWqyLWBxZQAAAABJRU5ErkJggg==",
handler:k}]:[]).show();break;default:k()}}catch(c){kb.alert(kb.error.parse(c))}}).catch(n=>kb.alert(kb.error.parse(n)))}};
window.KintoneBoosterField=class{constructor(){this.cache={};this.reserved="CATEGORY CREATED_TIME CREATOR GROUP HR LABEL MODIFIER RECORD_NUMBER REFERENCE_TABLE SPACER STATUS STATUS_ASSIGNEE UPDATED_TIME __ID__ __REVISION__".split(" ")}activate(f,l,n=!0){var k=kb.field.parallelize(l.fields),c=()=>kb.create("div").css({zIndex:kb.popups.alert.cover.style.zIndex-4}).append(kb.create("img").attr("src","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoV2luZG93cykiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QkVGNzA3QTE1RTc4MTFFOEI5MDA5RUE2NDFCQTUzNDciIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6QkVGNzA3QTI1RTc4MTFFOEI5MDA5RUE2NDFCQTUzNDciPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpCRUY3MDc5RjVFNzgxMUU4QjkwMDlFQTY0MUJBNTM0NyIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpCRUY3MDdBMDVFNzgxMUU4QjkwMDlFQTY0MUJBNTM0NyIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PkBlNTAAAADNSURBVHja7NHBCcJAFATQZNBcYwmSmycPlpI2bCVgAVqAVmAFHmxqncAKQVyz+/N/grADc0iyy0Be6ZwrlgiKhZKH83Ae/v/h1X23l9499vfZk2hYOHpgO7ZkH+xzjl9dsze2Ytfsld3MMXxhm8Hzlj1bD/eu7Zf3rf9mMvx2DaXzZ1SHh66hVP5MrTn86RpK48+qDIdcQ4nyxkRXsTcmuoq9oeAq8oaSa7I3FF2TvKHomuQNZddobxi4RnnDyHXUG0auo94wdP3p/RJgAMw4In5GE/6/AAAAAElFTkSuQmCC")).append(kb.create("span")),
e=a=>{((g,h)=>{f.elm(".kb-field-alert")?f.elm(".kb-field-alert").hide():f.elms("input,select,textarea").each((m,p)=>{m.alert&&m.alert.hide()});kb.event.call(a,{container:h,record:kb.record.get(g,l,!0).record}).then(m=>{m.error||(n?kb.event.call("kb.action.call",{container:g,record:m.record,pattern:"change",field:(p=>{var u=p.code;p.lookup&&(u=p.lookup.fieldMappings.reduce((d,q)=>{d.index<kb.field.cache[l.id].layout.indexOf(q.field)&&(d={index:kb.field.cache[l.id].layout.indexOf(q.field),field:q.field});
return d},{index:-1,field:null}),u=u.field||p.code);return u})(k[f.attr("field-id")])}).then(p=>{kb.event.call("kb.style.call",{container:g,record:p.record,pattern:"$id"in p.record?p.record.$id.value?"edit":"create":"create"}).then(u=>{kb.record.set(g,l,u.record);u=new Event("change");g.attr("unsaved","unsaved").dispatchEvent(u)}).catch(()=>{})}):(kb.record.set(g,l,m.record),(p=>{g.attr("unsaved","unsaved").dispatchEvent(p)})(new Event("change"))))})})(f.closest("[form-id=form_"+l.id+"]"),f.closest(".kb-scope"))};
f.attr("field-id")&&((a,g)=>{if(g.lookup)(h=>{a.elm(".kb-search").on("click",m=>{h(a.elm(".kb-lookup-search").val(),kb.extend({},g))});a.elm(".kb-clear").on("click",m=>{kb.confirm(kb.constants.common.message.confirm.delete[kb.operator.language],()=>{a.lookup("").then(()=>e("kb.change."+g.code))})});a.elm("input").on("change",m=>{h(m.currentTarget.val(),kb.extend({},g))})})((h,m)=>{this.load(m.lookup.relatedApp.app).then(p=>{(u=>{var d=()=>{m.picker=(q=>{var b={};q.each((r,t)=>{r in u.external&&(b[r]=
kb.extend({},u.external[r]))});0==Object.keys(b).length&&(b.$id={code:"$id",type:"RECORD_NUMBER",label:kb.constants.picker.caption.recordnumber[kb.operator.language],required:!1,noLabel:!1});return b})(m.lookup.lookupPickerFields);a.recordPicker.show({app:m.lookup.relatedApp.app,query:m.query,sort:m.lookup.sort||"$id asc",picker:m.picker},q=>a.lookup(q.$id.value).then(()=>e("kb.change."+m.code)))};h?(m.query=[m.lookup.filterCond,m.lookup.relatedKeyField+("NUMBER"==m.type?"=":" like ")+'"'+h+'"'].filter(q=>
q).join(" and "),kb.api(kb.api.url("/api/records"),"GET",{app:m.lookup.relatedApp.app,query:m.query}).then(q=>{1==q.records.length?a.lookup(q.records.first().$id.value).then(()=>e("kb.change."+m.code)):d()}).catch(q=>kb.alert(kb.error.parse(q)))):(m.query=m.lookup.filterCond,d())})({external:p.parallelize,internal:k})})}),a.recordPicker=new KintoneBoosterRecordPicker("record"),a.lookup=(h,m)=>new Promise((p,u)=>{(d=>{var q=()=>{kb.record.set(d,g.tableCode?l.fields[g.tableCode]:l,(()=>g.lookup.fieldMappings.reduce((b,
r)=>{if(r.field in k)switch(k[r.field].type){case "CHECK_BOX":case "FILE":case "GROUP_SELECT":case "MULTI_SELECT":case "ORGANIZATION_SELECT":case "USER_SELECT":b[r.field]={value:[]};break;default:b[r.field]={value:""}}return b},(b=>{b[g.code]={value:""};return b})({})))(),!1).then(()=>p())};h?kb.api(kb.api.url("/api/record"),"GET",{app:g.lookup.relatedApp.app,id:h}).then(b=>{b.record?kb.record.set(d,g.tableCode?l.fields[g.tableCode]:l,(()=>g.lookup.fieldMappings.reduce((r,t)=>{t.relatedField in b.record&&
t.field in k&&(r[t.field]={value:b.record[t.relatedField].value});return r},(r=>{r[g.code]={value:b.record[g.lookup.relatedKeyField].value};return r})({})))(),!1).then(()=>p()):q()}).catch(b=>kb.alert(kb.error.parse(b))):m?kb.api(kb.api.url("/api/records"),"GET",{app:g.lookup.relatedApp.app,query:g.lookup.relatedKeyField+'="'+m+'"'}).then(b=>{1==b.records.length?(r=>{kb.record.set(d,g.tableCode?l.fields[g.tableCode]:l,(()=>g.lookup.fieldMappings.reduce((t,v)=>{v.relatedField in r&&v.field in k&&(t[v.field]=
{value:r[v.relatedField].value});return t},(t=>{t[g.code]={value:r[g.lookup.relatedKeyField].value};return t})({})))(),!1).then(()=>p())})(b.records.first()):q()}).catch(b=>kb.alert(kb.error.parse(b))):q()})(a.closest(".kb-scope"))});else switch(g.type){case "CHECK_BOX":case "MULTI_SELECT":g.required&&(a.alert=h=>{a.elm(".kb-field-alert")||a.append(c().addClass("kb-field-alert"));a.elm(".kb-field-alert").elm("span").html(h).parentNode.show()});break;case "COLOR":a.elm(".kb-search").on("click",h=>
{kb.pickupColor(m=>{a.css({backgroundColor:m}).elm("input").val(m);e("kb.change."+g.code)})});a.elm("input").on("change",h=>{h.currentTarget.val()?(h=h.currentTarget.val().replace(/#/g,""),h.match(/([0-9A-Fa-f]{3}|[0-9A-Fa-f]{6})$/g)&&(a.css({backgroundColor:"#"+h}).elm("input").val("#"+h),e("kb.change."+g.code))):(a.css({backgroundColor:"transparent"}),e("kb.change."+g.code))});break;case "CONDITION":a.elm(".kb-search").on("click",h=>{kb.filter.build(g.app,a.elm("input").val(),m=>{a.elm("input").val(m);
e("kb.change."+g.code)})});a.reset=h=>{g.app=h;a.elm("input").val("");a.elm(".kb-guide").empty()};a.guide=h=>{a.elm(".kb-guide").append((m=>{m.append(kb.create("button").addClass("kb-icon kb-icon-del kb-guide-item-icon").on("click",p=>{kb.confirm(kb.constants.common.message.confirm.delete[kb.operator.language],()=>{a.elm("input").val(a.elm("input").val().split(" and ").filter(u=>u!=h).join(" and "));e("kb.change."+g.code)})})).append(kb.create("span").addClass("kb-guide-item-label").html(h));return m})(kb.create("span").addClass("kb-guide-item")))};
g.required&&(a.alert=h=>{a.elm(".kb-field-alert")||a.append(c().addClass("kb-field-alert"));a.elm(".kb-field-alert").elm("span").html(h).parentNode.show()});break;case "DATE":a.elm(".kb-search").on("click",h=>{kb.pickupDate(a.elm("input").val(),m=>{a.elm("input").val(m);e("kb.change."+g.code)})});break;case "DATETIME":a.elm(".kb-search").on("click",h=>{kb.pickupDate(a.elm("input").val(),m=>{a.elm("input").val(m);e("kb.change."+g.code)})});break;case "FILE":a.elm(".kb-search").on("click",h=>{(m=>{kb.elm("body").append(m.on("change",
p=>{p.currentTarget.files?(u=>{kb.file.upload(Array.from(p.currentTarget.files).first()).then(d=>{a.elm("input").val(JSON.stringify((a.elm("input").val()?JSON.parse(a.elm("input").val()):[]).concat(d)));e("kb.change."+g.code)}).catch(d=>kb.alert(kb.error.parse(d))).finally(()=>document.body.removeChild(m))})(Array.from(p.currentTarget.files).first()):document.body.removeChild(m)}));m.click()})(kb.create("input").attr("type","file").css({display:"none"}))});a.guide=h=>{a.elm(".kb-guide").append((m=>
{m.append(kb.create("button").addClass("kb-icon kb-icon-del kb-guide-item-icon").on("click",p=>{kb.confirm(kb.constants.common.message.confirm.delete[kb.operator.language],()=>{a.elm("input").val(JSON.stringify(JSON.parse(a.elm("input").val()).filter(u=>u.fileKey!=h.fileKey)));e("kb.change."+g.code)})})).append(kb.create("span").addClass("kb-guide-item-label").html(h.name).on("click",p=>a.open(h)));return m})(kb.create("span").addClass("kb-guide-item")))};a.open=h=>{kb.attachment.show(h,!1)};g.required&&
(a.alert=h=>{a.elm(".kb-field-alert")||a.append(c().addClass("kb-field-alert"));a.elm(".kb-field-alert").elm("span").html(h).parentNode.show()});break;case "GROUP_SELECT":case "ORGANIZATION_SELECT":case "USER_SELECT":(h=>{a.elm(".kb-search").on("click",m=>{a.recordPicker.show({picker:{name:{code:"name",type:"SINGLE_LINE_TEXT",label:kb.constants.picker.caption.name[kb.operator.language],required:!1,noLabel:!0}}},p=>{(u=>{(d=>{p.each((q,b)=>{d.includes(q.code.value)||u.push({code:q.code.value,name:q.name.value})})})(u.map(d=>
d.code));a.elm("input").val(JSON.stringify(u));e("kb.change."+g.code)})(a.elm("input").val()?JSON.parse(a.elm("input").val()):[])})});a.recordPicker=new KintoneBoosterRecordPicker(h,!0,(()=>{var m=[];g.loginuser&&m.push({code:{value:"LOGINUSER()"},name:{value:"Login user"}});g.guestuser&&m.push({code:{value:"GUESTUSER()"},name:{value:"Guest user"}});return m})());a.guide=m=>{a.elm(".kb-guide").append((p=>{p.append(kb.create("button").addClass("kb-icon kb-icon-del kb-guide-item-icon").on("click",u=>
{kb.confirm(kb.constants.common.message.confirm.delete[kb.operator.language],()=>{a.elm("input").val(JSON.stringify(JSON.parse(a.elm("input").val()).filter(d=>d.code!=m.code)));e("kb.change."+g.code)})})).append(kb.create("span").addClass("kb-guide-item-label").html(m.name));return p})(kb.create("span").addClass("kb-guide-item")))};g.required&&(a.alert=m=>{a.elm(".kb-field-alert")||a.append(c().addClass("kb-field-alert"));a.elm(".kb-field-alert").elm("span").html(m).parentNode.show()})})((()=>{var h=
"";switch(g.type){case "GROUP_SELECT":h="group";break;case "ORGANIZATION_SELECT":h="organization";break;case "USER_SELECT":h="user"}return h})());case "NUMBER":(h=>{a.on("show",m=>h());h()})(()=>{a.elm(".kb-unit")?a.elm("input").css({width:"calc(100% - "+a.elm(".kb-unit").outerWidth(!0)+"px)"}):a.elm("input").css({width:null})});break;case "RADIO_BUTTON":a.elms("[data-name="+g.code+"]").each((h,m)=>{h.closest("label").on("click",p=>{(u=>{a.elms("[data-name="+g.code+"]").each((d,q)=>d.checked=u==d.val());
e("kb.change."+g.code)})(h.val());p.stopPropagation();p.preventDefault()})});break;case "TIME":a.elm(".kb-hour").elm("select").on("change",h=>{h.currentTarget.val()||a.elm(".kb-minute").elm("select").val("");e("kb.change."+g.id)}),a.elm(".kb-minute").elm("select").on("change",h=>{h.currentTarget.val()||a.elm(".kb-hour").elm("select").val("");e("kb.change."+g.id)})}a.elms("input,select,textarea").each((h,m)=>{switch(g.type){case "COLOR":case "CONDITION":case "FILE":case "GROUP_SELECT":case "ORGANIZATION_SELECT":case "RADIO_BUTTON":case "TIME":case "USER_SELECT":break;
default:h.on("change",p=>e("kb.change."+g.code))}})})(f.elm(".kb-field-value"),k[f.attr("field-id")]);return f}blobToBase64(f,l){var n=new FileReader;n.onload=()=>{l(n.result.replace(/^data:.+;base64,/,""))};n.readAsDataURL(f)}create(f,l=!1){var n=k=>{k.append(kb.create("div").addClass("kb-dropdown kb-hour").append(kb.create("select").assignOption((()=>{var c=[{value:""}];(24).each(e=>c.push({value:e.toString().lpad("0",2)}));return c})(),"value","value"))).append(kb.create("div").addClass("kb-dropdown kb-minute").append(kb.create("select").assignOption((()=>
{var c=[{value:""}];(60).each(e=>c.push({value:e.toString().lpad("0",2)}));return c})(),"value","value")))};if(!("type"in f))throw Error("You shoud setup [type] in field information");return(k=>{k.append(kb.create("span").addClass("kb-field-caption").html(f.label));f.noLabel&&k.elm(".kb-field-caption").addClass("kb-hidden");k.append((c=>{switch(f.type){case "CALC":switch(f.format){case "NUMBER":case "NUMBER_DIGIT":c.addClass("kb-number")}break;case "CHECK_BOX":case "MULTI_SELECT":(e=>{e.reduce((a,
g)=>{a[g.index]=g;return a},Array(e.length).fill("")).each((a,g)=>{c.addClass("kb-checkbox").append(kb.create("label").append(kb.create("input").attr("type","checkbox").val(a.label)).append(kb.create("span").html(a.label)))})})(Object.values(f.options));break;case "COLOR":c.addClass("kb-color").append(kb.create("input").attr("type","text").attr("data-type","color")).append(kb.create("button").addClass("kb-icon kb-icon-color kb-search"));break;case "CONDITION":c.addClass("kb-condition").append(kb.create("input").attr("type",
"hidden")).append(kb.create("button").addClass("kb-icon kb-icon-filter kb-search"));break;case "CREATOR":case "CREATED_TIME":case "MODIFIER":case "UPDATED_TIME":c.append(kb.create("input").attr("type","hidden").attr("data-type",f.type.toLowerCase()));break;case "DATE":c.addClass("kb-date").append(kb.create("input").attr("type","text").attr("data-type","date")).append(kb.create("button").addClass("kb-icon kb-icon-date kb-search"));break;case "DATETIME":n(c.addClass("kb-datetime").append(kb.create("input").attr("type",
"text").attr("data-type","date")).append(kb.create("button").addClass("kb-icon kb-icon-date kb-search")));break;case "DROP_DOWN":(e=>{l?c.addClass("kb-dropdown").append(kb.create("select").assignOption([{label:""}].concat(e.reduce((a,g)=>{g.label&&(a[g.index]=g);return a},Array(e.length).fill(""))),"label","label")):c.addClass("kb-dropdown").append(kb.create("select").assignOption(e.reduce((a,g)=>{a[g.index]=g;return a},Array(e.length).fill("")),"label","label"))})(Object.values(f.options));break;
case "FILE":c.addClass("kb-file").append(kb.create("input").attr("type","hidden")).append(kb.create("button").addClass("kb-icon kb-icon-file kb-search"));break;case "GROUP_SELECT":c.addClass("kb-group").append(kb.create("input").attr("type","hidden")).append(kb.create("button").addClass("kb-icon kb-icon-group kb-search"));break;case "LINK":switch(f.protocol){case "WEB":c.addClass("kb-text").append(kb.create("input").attr("type","text").attr("data-type","url"));break;case "CALL":c.addClass("kb-text").append(kb.create("input").attr("type",
"text").attr("data-type","tel"));break;case "MAIL":c.addClass("kb-text").append(kb.create("input").attr("type","text").attr("data-type","mail"))}break;case "MULTI_LINE_TEXT":case "RICH_TEXT":c.addClass("kb-textarea").append((e=>{f.lines&&e.css({height:"calc("+(1.5*parseFloat(f.lines)).toString()+"em + 2px)"});return e})(kb.create("textarea")));break;case "NUMBER":f.lookup?c.addClass("kb-lookup").append(kb.create("input").addClass("kb-lookup-search").attr("type","text").attr("data-type","nondemiliternumber")).append(kb.create("button").addClass("kb-icon kb-icon-lookup kb-search")).append(kb.create("button").addClass("kb-icon kb-icon-open kb-open")).append(kb.create("button").addClass("kb-icon kb-icon-del kb-clear")):
(c.addClass("kb-number").append((e=>{"displayScale"in f&&e.attr("data-decimals",f.displayScale);return e.attr("data-type",f.digit?"number":"nondemiliternumber")})(kb.create("input").attr("type","text"))),f.unit&&(e=>{"prefix"==f.unitPosition?c.insertBefore(e,c.elm("input")):c.insertBefore(e,c.elm("input").nextElementSibling)})(kb.create("span").addClass("kb-unit").html(f.unit)));break;case "ORGANIZATION_SELECT":c.addClass("kb-organization").append(kb.create("input").attr("type","hidden")).append(kb.create("button").addClass("kb-icon kb-icon-organization kb-search"));
break;case "RADIO_BUTTON":(e=>{e.reduce((a,g)=>{a[g.index]=g;return a},Array(e.length).fill("")).each((a,g)=>{var h=c.addClass("kb-radio"),m=h.append;a=kb.create("label").append(kb.create("input").attr("type","radio").attr("data-name",f.code).val(a.label)).append(kb.create("span").html(a.label));0==g&&(a.elm("input").checked=!0);m.call(h,a)})})(Object.values(f.options));break;case "RECORD_NUMBER":c.addClass("kb-id");break;case "SINGLE_LINE_TEXT":if(f.lookup)c.addClass("kb-lookup").append(kb.create("input").addClass("kb-lookup-search").attr("type",
"text").attr("data-type","text")).append(kb.create("button").addClass("kb-icon kb-icon-lookup kb-search")).append(kb.create("button").addClass("kb-icon kb-icon-open kb-open")).append(kb.create("button").addClass("kb-icon kb-icon-del kb-clear"));else switch(f.format){case "password":c.addClass("kb-text").append(kb.create("input").attr("type","password").attr("data-type",f.type));break;default:c.addClass("kb-text").append(kb.create("input").attr("type","text").attr("data-type",f.format?f.format:"text"))}break;
case "SPACER":c.html(f.contents);break;case "STATUS_ASSIGNEE":c.append(kb.create("input").attr("type","hidden"));break;case "TIME":n(c);break;case "USER_SELECT":c.addClass("kb-user").append(kb.create("input").attr("type","hidden")).append(kb.create("button").addClass("kb-icon kb-icon-user kb-search"))}return"SPACER"!=f.type?c.append(kb.create("span").addClass("kb-guide")):c})(kb.create("div").addClass("kb-field-value")));switch(f.type){case "CALC":case "CATEGORY":case "CONDITION":case "CREATED_TIME":case "CREATOR":case "FILE":case "GROUP_SELECT":case "MODIFIER":case "ORGANIZATION_SELECT":case "RECORD_NUMBER":case "REFERENCE_TABLE":case "STATUS":case "STATUS_ASSIGNEE":case "UPDATED_TIME":case "USER_SELECT":k.elm(".kb-guide").addClass("kb-fixed")}if(f.required)switch(f.type){case "CALC":case "CATEGORY":case "CHECK_BOX":case "CONDITION":case "CREATED_TIME":case "CREATOR":case "FILE":case "GROUP_SELECT":case "MODIFIER":case "MULTI_SELECT":case "ORGANIZATION_SELECT":case "RECORD_NUMBER":case "REFERENCE_TABLE":case "STATUS":case "STATUS_ASSIGNEE":case "UPDATED_TIME":case "USER_SELECT":break;
default:k.elms("input,select,textarea").each((c,e)=>c.attr("required","required"))}f.placeholder&&k.elms("input,select,textarea").each((c,e)=>c.attr("placeholder",f.placeholder));return k})(kb.create("div").addClass("kb-field").attr("field-id",f.code))}isEmpty(f){var l=!0;if(Array.isArray(f))l=0==f.length;else switch(typeof f){case "object":l=null===f||0==Object.keys(f).length;break;case "number":l=Number.isNaN(f);break;case "string":l=0==f.toString().length}return l}load(f){return new Promise((l,
n)=>{f in this.cache?l(this.cache[f]):fetch(kb.api.url("/api/fields?app="+f),{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest"}}).then(k=>{k.json().then(c=>{switch(k.status){case 200:(e=>{var a=[],g=[],h=[],m=(p,u=!0)=>p.reduce((d,q)=>{switch(q.type){case "GROUP":u&&a.push(q.code);d=d.concat(m(q.layout));break;case "ROW":u&&(g=q.fields.reduce((b,r)=>{r.elementId&&b.push(r);return b},g));d=q.fields.reduce((b,r)=>{"code"in r&&b.push(r.code);return b},d);break;case "SUBTABLE":u?(h.push({code:q.code,
fields:q.fields}),d=q.fields.reduce((b,r)=>{"code"in r&&b.push(r.code);return b},d)):d.push(q.code)}return d},[]);(p=>{p.each((u,d)=>{delete c.properties[u]})})(Object.values(c.properties).reduce((p,u)=>{switch(u.type){case "CATEGORY":u.enabled||p.push(u.code);break;case "STATUS":u.enabled||(p.push(u.code),p.push(Object.values(c.properties).filter(d=>"STATUS_ASSIGNEE"==d.type).first().code))}return p},[]));((p,u)=>{this.cache[f]={origin:((d,q)=>{d=d.reduce((r,t)=>{r[t]=q[t];"SUBTABLE"==q[t].type&&
(r[t].fields=(v=>v.fields.reduce((w,x)=>{w[x.code]=q[v.code].fields[x.code];return w},{}))(h.filter(v=>v.code==t).first()));delete q[t];return r},{});for(var b in q)d[b]=q[b];return d})(m(e,!1),kb.extend({},c.properties)),groups:a.reduce((d,q)=>{d[q]=c.properties[q];return d},{}),tables:h.reduce((d,q)=>{d[q.code]=(b=>{b.fields=q.fields.reduce((r,t)=>{r[t.code]=p[t.code];return r},{});return b})(c.properties[q.code]);return d},{}),changes:(d=>{var q=[];q=Object.values(p).reduce((b,r)=>{d.includes(r.code)||
b.push(r.code);return b},[]);return q.concat(h.map(b=>b.code))})((()=>{var d=[],q;for(q in p)(b=>{kb.field.reserved.includes(b.type)?d.push(b.code):(b.expression&&d.push(b.code),b.lookup&&(d.push(b.code),(r=>{r.field&&(d=d.concat(b.lookup.fieldMappings.reduce((t,v)=>{v.field!=r.field&&t.push(v.field);return t},[])))})(b.lookup.fieldMappings.reduce((r,t)=>{r.index<u.indexOf(t.field)&&(r={index:u.indexOf(t.field),field:t.field});return r},{index:-1,field:null}))))})(p[q]);return Array.from(new Set(d))})()),
criterias:(()=>{var d={};u.each((b,r)=>{["FILE","REFERENCE_TABLE"].includes(p[b].type)||(d[b]=p[b])});for(var q in p)(b=>{switch(b.type){case "CALC":case "CREATED_TIME":case "CREATOR":case "MODIFIER":case "RECORD_NUMBER":case "UPDATED_TIME":d[b.code]=b;break;case "STATUS":b.enabled&&(d[b.code]=b,(r=>{d[r.code]=r})(Object.values(p).filter(r=>"STATUS_ASSIGNEE"==r.type).first()))}})(p[q]);return d})(),disables:(()=>{var d=[],q;for(q in p)(b=>{kb.field.reserved.includes(b.type)?d.push(b.code):(b.expression&&
d.push(b.code),b.lookup&&(r=>{0!=r.length&&(d=d.concat(r))})(b.lookup.fieldMappings.map(r=>r.field)))})(p[q]);return Array.from(new Set(d))})(),layout:u,parallelize:(()=>{var d={};u.each((b,r)=>{d[b]=p[b]});for(var q in p)(b=>{switch(b.type){case "CATEGORY":b.enabled&&(d[b.code]=b);break;case "CREATED_TIME":case "CREATOR":case "MODIFIER":case "RECORD_NUMBER":case "UPDATED_TIME":d[b.code]=b;break;case "STATUS":b.enabled&&(d[b.code]=b,(r=>{d[r.code]=r})(Object.values(p).filter(r=>"STATUS_ASSIGNEE"==
r.type).first()))}})(p[q]);return d})(),placed:(()=>{var d={};u.each((q,b)=>{["REFERENCE_TABLE"].includes(p[q].type)||(d[q]=p[q])});return d})(),spacers:g,sorts:(()=>{var d={};u.each((b,r)=>{b=p[b];switch(b.type){case "CALC":case "CREATED_TIME":case "CREATOR":case "DATE":case "DATETIME":case "DROP_DOWN":case "LINK":case "MODIFIER":case "NUMBER":case "RADIO_BUTTON":case "RECORD_NUMBER":case "SINGLE_LINE_TEXT":case "TIME":case "UPDATED_TIME":b.tableCode||(d[b.code]=b)}});for(var q in p)(b=>{switch(b.type){case "CALC":case "CREATED_TIME":case "CREATOR":case "MODIFIER":case "RECORD_NUMBER":case "UPDATED_TIME":d[b.code]=
b;break;case "STATUS":b.enabled&&(d[b.code]=b)}})(p[q]);return d})()};l(this.cache[f])})(kb.field.parallelize(c.properties),m(e))})(c.layout);break;default:kb.alert(kb.error.parse(c))}})}).catch(k=>kb.alert(kb.error.parse(k)))})}parallelize(f){f=kb.extend({},f);var l={},n;for(n in f){var k=void 0,c=f[n];switch(c.type){case "SUBTABLE":var e=c.code;for(k in c.fields)c.fields[k]=kb.extend({tableCode:e},c.fields[k]),l[c.fields[k].code]=c.fields[k];break;default:c=kb.extend({tableCode:""},c),l[c.code]=
c}}return l}stringify(f,l,n,k=!1){var c="";if(f&&l)switch(f.type){case "CATEGORY":case "CHECK_BOX":case "MULTI_SELECT":c=l.join(n);break;case "CREATOR":case "MODIFIER":c=l.name;break;case "CREATED_TIME":case "DATETIME":case "UPDATED_TIME":c=l.parseDateTime().format("Y-m-d H:i");break;case "FILE":case "GROUP_SELECT":case "ORGANIZATION_SELECT":case "STATUS_ASSIGNEE":case "USER_SELECT":c=l.map(e=>e.name).join(n);break;case "MULTI_LINE_TEXT":case "RICH_TEXT":c=k?l:l.replace(/\n/g,"");break;case "NUMBER":kb.isNumeric(l)&&
(c=f.digit?Number(l).comma(f.displayScale):f.displayScale?Number(l).toFloor(parseInt(f.displayScale)):l);f.unit&&(c="prefix"==f.unitPosition?f.unit+" "+c:c+" "+f.unit);break;default:c=l}return c}objectUrl(f,l){var n=null,k=window.URL||window.webkitURL;if("string"===typeof f){var c=atob(f),e=new Uint8Array(c.length);c.length.each(a=>e[a]=c.charCodeAt(a));n=new Blob([e.buffer],{type:l})}else n=f;return k.createObjectURL(n)}};
window.KintoneBoosterRecord=class{constructor(){this.api={delete:(f,l,n=!1)=>new Promise((k,c)=>{var e=(a,g)=>{0!=l.length?kb.api(kb.api.url("/api/records"),"DELETE",{app:f,ids:l.slice(a,a+100)}).then(h=>{n||kb.progressUpdate();a+=100;0<l.slice(a,a+100).length?e(a,g):g()}).catch(h=>c(h)):g()};n||kb.progressStart(Math.ceil(l.length/100));e(0,()=>{n||kb.progressEnd();k()})}),get:(f,l,n)=>new Promise((k,c)=>{(e=>{var a=(g,h,m)=>{kb.api(kb.api.url("/api/records"),"GET",{app:f,query:l+" order by "+e+" limit 500 offset "+
h.toString()}).then(p=>{Array.prototype.push.apply(g,p.records);h+=500;500==p.records.length?a(g,h,m):m(g)}).catch(p=>c(p))};kb.api(kb.api.url("/api/records"),"GET",{app:f,query:l}).then(g=>{1E4>parseInt(g.totalCount)?a([],0,h=>k(h)):kb.api(kb.api.url("/api/cursor"),"GET",{app:f,query:l+" order by "+e}).then(h=>k(h.records)).catch(h=>c(h))}).catch(g=>c(g))})(n||"$id asc")}),set:(f,l,n=!1,k=!1)=>new Promise((c,e)=>{var a=(h,m)=>{0!=l.post.length?kb.api(kb.api.url("/api/records"),"POST",{app:f,records:(p=>
{k&&(p=p.map(u=>this.api.transform(u,"POST")));return p})(l.post.slice(h,h+100))}).then(p=>{n||kb.progressUpdate();h+=100;0<l.post.slice(h,h+100).length?a(h,m):m(p.ids.last())}).catch(p=>e(p)):m()},g=(h,m)=>{0!=l.put.length?kb.api(kb.api.url("/api/records"),"PUT",{app:f,records:(p=>{k&&(p=p.map(u=>this.api.transform(u.record)));return p})(l.put.slice(h,h+100))}).then(p=>{n||kb.progressUpdate();h+=100;0<l.put.slice(h,h+100).length?g(h,m):m()}).catch(p=>e(p)):m()};"post"in l||(l.post=[]);"put"in l||
(l.put=[]);n||kb.progressStart(Math.ceil(l.post.length/100)+Math.ceil(l.put.length/100));a(0,h=>{g(0,()=>{n||kb.progressEnd();c(h)})})}),transform:(f,l="PUT")=>{var n=null;switch(l){case "POST":n=(()=>{var k={},c;for(c in f)kb.field.reserved.includes(f[c].type)||(k[c]=f[c]);return k})();break;case "PUT":n={id:f.$id.value,record:(()=>{var k={},c;for(c in f)kb.field.reserved.includes(f[c].type)||(k[c]=f[c]);return k})()}}return n}}}clear(f,l){for(var n in l.fields)((k,c)=>{if(k)switch("SUBTABLE"!=c.type&&
(k=k.elm(".kb-field-value")),c.type){case "CHECK_BOX":k.elms("input").each((e,a)=>e.checked=!1);break;case "RADIO_BUTTON":k.elms("[data-name="+n+"]").each((e,a)=>e.checked=0==a);break;case "SUBTABLE":k.clearRows();k.addRow();break;default:k.elms("input,select,textarea").each((e,a)=>e.val(""))}})(f.elm('[field-id="'+CSS.escape(n)+'"]'),l.fields[n]);f.elm("[data-type=id]")&&f.elm("[data-type=id]").val("")}create(f,l=!0){var n={},k;for(k in f.fields)(c=>{switch(c.type){case "CHECK_BOX":case "CONDITION":case "FILE":case "GROUP_SELECT":case "MULTI_SELECT":case "ORGANIZATION_SELECT":case "USER_SELECT":n[k]=
{type:c.type,value:[]};break;case "RADIO_BUTTON":(e=>{n[k]={type:c.type,value:0!=e.length?e.reduce((a,g)=>{a[g.index]=g;return a},Array(e.length).fill("")).first().label:""}})(Object.values(c.options));break;case "SUBTABLE":n[k]={type:c.type,value:[{value:this.create(c,!1)}]};break;default:kb.field.reserved.includes(c.type)||(n[k]={type:c.type,value:""})}})(f.fields[k]);l&&(n.$id={type:"__ID__",value:""});return n}get(f,l,n){var k={error:!1,record:{}};if(!n)for(var c in l.fields)if(((e,a)=>{if(e)switch("SUBTABLE"!=
a.type&&(e=e.elm(".kb-field-value")),a.type){case "CHECK_BOX":case "MULTI_SELECT":a.required&&!e.elms("input").some(g=>g.checked)&&(e.alert(kb.constants.common.message.invalid.required[kb.operator.language]),k.error=!0);break;case "FILE":case "GROUP_SELECT":case "ORGANIZATION_SELECT":case "USER_SELECT":a.required&&(g=>{0==g.length&&(e.alert(kb.constants.common.message.invalid.required[kb.operator.language]),k.error=!0)})(e.elm("input").val()?JSON.parse(e.elm("input").val()):[]);break;case "SUBTABLE":break;
default:e.elms("input,select,textarea").each((g,h)=>{g.checkValidity()||(k.error=!0)})}})(f.elm('[field-id="'+CSS.escape(c)+'"]'),l.fields[c]),k.error)break;if(k.error)kb.alert(kb.constants.common.message.invalid.record[kb.operator.language]);else{for(c in l.fields)((e,a)=>{if(e)switch("SUBTABLE"!=a.type&&(e=e.elm(".kb-field-value")),a.type){case "CALC":k.record[a.code]={type:a.type,value:null};break;case "CHECK_BOX":case "MULTI_SELECT":k.record[a.code]={type:a.type,value:(()=>{var g=[];e.elms("input").each((h,
m)=>{h.checked&&!h.parentNode.hasClass("kb-hidden")&&g.push(h.val())});return g})()};break;case "CREATED_TIME":case "UPDATED_TIME":k.record[a.code]={type:a.type,value:e.elm("input").val()?e.elm("input").val():(new Date).format("ISO")};break;case "CREATOR":case "MODIFIER":k.record[a.code]={type:a.type,value:e.elm("input").val()?JSON.parse(e.elm("input").val()):{code:kb.operator.code,name:kb.operator.name}};break;case "DATETIME":k.record[a.code]={type:a.type,value:(()=>{var g="";e.elm("input").val()&&
(e.elm(".kb-hour").elm("select").val()||e.elm(".kb-hour").elm("select").val("00"),e.elm(".kb-minute").elm("select").val()||e.elm(".kb-minute").elm("select").val("00"));e.elm("input").val()&&e.elm(".kb-hour").elm("select").val()&&e.elm(".kb-minute").elm("select").val()&&(g=(e.elm("input").val()+" "+e.elm(".kb-hour").elm("select").val()+":"+e.elm(".kb-minute").elm("select").val()+":00").parseDateTime().format("ISO"));return g})()};break;case "DROP_DOWN":k.record[a.code]={type:a.type,value:e.elm("select").val()};
break;case "FILE":case "GROUP_SELECT":case "ORGANIZATION_SELECT":case "STATUS_ASSIGNEE":case "USER_SELECT":k.record[a.code]={type:a.type,value:e.elm("input").val()?JSON.parse(e.elm("input").val()):[]};break;case "MULTI_LINE_TEXT":case "RICH_TEXT":k.record[a.code]={type:a.type,value:e.elm("textarea").val()};break;case "NUMBER":k.record[a.code]={type:a.type,value:kb.isNumeric(e.elm("input").val())?parseFloat(e.elm("input").val()):e.elm("input").val()};break;case "RADIO_BUTTON":k.record[a.code]={type:a.type,
value:(()=>{var g="";e.elms("[data-name="+a.code+"]").each((h,m)=>{h.checked&&!h.parentNode.hasClass("kb-hidden")&&(g=h.val())});return g})()};break;case "RECORD_NUMBER":case "STATUS":k.record[a.code]={type:a.type,value:e.elm(".kb-guide").text()};break;case "SUBTABLE":k.record[a.code]={type:a.type,value:(()=>{var g=[];e.tr.each((h,m)=>{m=this.get(h,a,n);if(m.error)return k.error=m.error,KB_BREAK;g.push(h.hasAttribute("row-id")?{id:h.attr("row-id"),value:m.record}:{value:m.record})});return g})()};
break;case "TIME":k.record[a.code]={type:a.type,value:(()=>{var g="";e.elm(".kb-hour").elm("select").val()&&(e.elm(".kb-minute").elm("select").val()||e.elm(".kb-minute").elm("select").val("00"));e.elm(".kb-minute").elm("select").val()&&(e.elm(".kb-hour").elm("select").val()||e.elm(".kb-hour").elm("select").val("00"));e.elm(".kb-hour").elm("select").val()&&e.elm(".kb-minute").elm("select").val()&&(g=e.elm(".kb-hour").elm("select").val()+":"+e.elm(".kb-minute").elm("select").val());return g})()};break;
default:kb.field.reserved.includes(a.type)||(k.record[a.code]={type:a.type,value:e.elm("input").val()})}})(f.elm('[field-id="'+CSS.escape(c)+'"]'),l.fields[c]);f.elm("[data-type=id]")&&(k.record.$id={value:f.elm("[data-type=id]").val()?parseInt(f.elm("[data-type=id]").val()):f.elm("[data-type=id]").val()})}return k}set(f,l,n){return new Promise((k,c)=>{var e=(a,g,h,m)=>{var p=[],u;for(u in h)((d,q,b)=>{if(d&&b){"disabled"in b&&(b.disabled?d.addClass("kb-disabled"):d.removeClass("kb-disabled"));"hidden"in
b&&(b.hidden?d.addClass("kb-hidden"):d.removeClass("kb-hidden"));if("SUBTABLE"!=q.type)switch(d=d.elm(".kb-field-value"),"backcolor"in b&&(b.backcolor?d.addClass("kb-force-backcolor").elm(".kb-guide").css({backgroundColor:b.backcolor}):d.removeClass("kb-force-backcolor").elm(".kb-guide").css({backgroundColor:""})),"forecolor"in b&&(b.forecolor?d.addClass("kb-force-forecolor").elm(".kb-guide").css({color:b.forecolor}):d.removeClass("kb-force-forecolor").elm(".kb-guide").css({color:""})),"error"in b&&
(d.alert?d.alert(b.error):d.elms("input,select,textarea").each((t,v)=>{t.alert&&t.alert.elm("span").html(b.error).parentNode.show()})),q.type){case "CALC":case "CATEGORY":case "CHECK_BOX":case "CONDITION":case "CREATED_TIME":case "CREATOR":case "FILE":case "GROUP_SELECT":case "MODIFIER":case "MULTI_SELECT":case "ORGANIZATION_SELECT":case "RADIO_BUTTON":case "RECORD_NUMBER":case "REFERENCE_TABLE":case "SPACER":case "STATUS":case "STATUS_ASSIGNEE":case "UPDATED_TIME":case "USER_SELECT":"backcolor"in
b&&d.css({backgroundColor:b.backcolor?b.backcolor:""});"forecolor"in b&&d.css({color:b.forecolor?b.forecolor:""});break;default:d.elms("input,select,textarea").each((t,v)=>{"backcolor"in b&&t.css({backgroundColor:b.backcolor?b.backcolor:""});"forecolor"in b&&t.css({color:b.forecolor?b.forecolor:""})})}switch(q.type){case "CALC":case "RECORD_NUMBER":case "STATUS":d.elm(".kb-guide").html(b.value);break;case "CATEGORY":d.elm(".kb-guide").html(b.value.join("<br>"));break;case "CHECK_BOX":case "MULTI_SELECT":d.elms("input").each((t,
v)=>{t.checked=b.value.includes(t.val())});d.elm(".kb-guide").html(b.value.join("<br>"));break;case "COLOR":d.css({backgroundColor:b.value?b.value:"transparent"}).elm("input").val(b.value);d.elm(".kb-guide").html(b.value);break;case "CONDITION":d.elm(".kb-guide").empty();b.value?(d.elm("input").val(b.value),b.value.split(" and ").each((t,v)=>d.guide(t))):d.elm("input").val("");break;case "CREATOR":case "MODIFIER":d.elm("input").val(JSON.stringify(b.value));d.elm(".kb-guide").html(b.value.name);break;
case "CREATED_TIME":case "UPDATED_TIME":b.value?(d.elm("input").val(b.value),d.elm(".kb-guide").html((new Date(b.value)).format("Y-m-d H:i"))):(d.elm("input").val(""),d.elm(".kb-guide").html(""));break;case "DATETIME":if(b.value){var r=b.value.parseDateTime();d.elm("input").val(r.format("Y-m-d"));d.elm(".kb-hour").elm("select").val(r.format("H"));d.elm(".kb-minute").elm("select").val(r.format("i"));d.elm(".kb-guide").html(r.format("Y-m-d H:i"))}else d.elm("input").val(""),d.elm(".kb-hour").elm("select").val(""),
d.elm(".kb-minute").elm("select").val(""),d.elm(".kb-guide").html("");break;case "DROP_DOWN":d.elm("select").val(b.value);d.elm(".kb-guide").html(d.elm("select").selectedText());break;case "FILE":case "GROUP_SELECT":case "ORGANIZATION_SELECT":case "USER_SELECT":d.elm(".kb-guide").empty();b.value?(d.elm("input").val(JSON.stringify(b.value)),b.value.each((t,v)=>d.guide(t))):d.elm("input").val("[]");break;case "LINK":d.elm("input").val(b.value);d.elm(".kb-guide").empty();if(b.value)switch(q.protocol){case "MAIL":d.elm(".kb-guide").append(kb.create("a").attr("href",
"mailto:"+b.value).html(b.value));break;case "CALL":d.elm(".kb-guide").append(kb.create("a").attr("href","tel:"+b.value).html(b.value));break;case "WEB":d.elm(".kb-guide").append(kb.create("a").attr("href",b.value).attr("target","_blank").html(b.value))}break;case "MULTI_LINE_TEXT":case "RICH_TEXT":d.elm("textarea").val(b.value);d.elm(".kb-guide").html(b.value.replace(/\n/g,"<br>"));break;case "NUMBER":b.lookup?p.push({field:d,value:b.value}):(q.digit?kb.isNumeric(b.value)?(d.elm("input").val(Number(b.value).comma(q.displayScale)),
d.elm(".kb-guide").html(Number(b.value).comma(q.displayScale))):(d.elm("input").val(b.value),d.elm(".kb-guide").html(b.value)):q.displayScale?kb.isNumeric(b.value)?(d.elm("input").val(Number(b.value).toFloor(parseInt(q.displayScale))),d.elm(".kb-guide").html(Number(b.value).toFloor(parseInt(q.displayScale)))):(d.elm("input").val(b.value),d.elm(".kb-guide").html(b.value)):(d.elm("input").val(b.value),d.elm(".kb-guide").html(b.value)),q.unit&&("prefix"==q.unitPosition?d.elm(".kb-guide").html(q.unit+
" "+d.elm(".kb-guide").text()):d.elm(".kb-guide").html(d.elm(".kb-guide").text()+" "+q.unit)));break;case "RADIO_BUTTON":d.elms("[data-name="+u+"]").each((t,v)=>{t.checked=b.value==t.val()});d.elm(".kb-guide").html(b.value);break;case "SPACER":break;case "STATUS_ASSIGNEE":d.elm(".kb-guide").empty();b.value?(d.elm("input").val(JSON.stringify(b.value)),b.value.each((t,v)=>{d.elm(".kb-guide").append(kb.create("span").addClass("kb-guide-item").append(kb.create("span").addClass("kb-guide-item-label").html(t.name)))})):
d.elm("input").val("[]");break;case "SUBTABLE":if(0==b.value.length)d.clearRows();else{d.tr.each((t,v)=>{b.value.length>v&&e(t,q,(w=>{if(b.disabled)for(var x in w)w[x].disabled=!0;return w})(b.value.map(w=>w.value)[v]),w=>p=p.concat(w))});for(r=d.tr.length;r<b.value.length;r++)e(d.addRow(),q,(t=>{if(b.disabled)for(var v in t)t[v].disabled=!0;return t})(b.value.map(t=>t.value)[r]),t=>p=p.concat(t));d.tr.slice(b.value.length).each((t,v)=>d.delRow(t))}0==d.tr.length?(t=>{b.disabled&&e(t,q,(v=>{for(var w in v)v[w].disabled=
!0;return v})(this.get(t,q,!0).record),v=>p=p.concat(v))})(d.addRow()):d.tr.each((t,v)=>{"id"in b.value[v]&&t.attr("row-id",b.value[v].id)});break;case "TIME":b.value?(d.elm(".kb-hour").elm("select").val(b.value.split(":")[0]),d.elm(".kb-minute").elm("select").val(b.value.split(":")[1]),d.elm(".kb-guide").html(b.value)):(d.elm(".kb-hour").elm("select").val(""),d.elm(".kb-minute").elm("select").val(""),d.elm(".kb-guide").html(""));break;default:b.lookup?p.push({field:d,value:b.value}):(d.elm("input").val(b.value),
d.elm(".kb-guide").html(b.value))}}})(a.elm('[field-id="'+CSS.escape(u)+'"]'),g.fields[u],h[u]);"$id"in h&&a.elm("[data-type=id]")&&a.elm("[data-type=id]").val(h.$id.value);m(p)};e(f,l,n,a=>{var g=(h,m)=>{0!=a.length?a[h].field.lookup(null,a[h].value).then(()=>{h++;h<a.length?g(h,m):m()}):m(!1)};g(0,()=>{k()})})})}simplify(f,l){var n={},k;for(k in f.fields)(c=>{switch(c.type){case "CATEGORY":case "CHECK_BOX":case "MULTI_SELECT":n[k]={value:k in l?Array.from(new Set(l[k].value.sort())):[]};break;case "CALC":case "CREATED_TIME":case "CREATOR":case "FILE":case "MODIFIER":case "RECORD_NUMBER":case "REFERENCE_TABLE":case "SPACER":case "STATUS":case "UPDATED_TIME":break;
case "GROUP_SELECT":case "ORGANIZATION_SELECT":case "STATUS_ASSIGNEE":case "USER_SELECT":n[k]={value:k in l?Array.from(new Set(l[k].value.map(e=>e.code).sort())):[]};break;case "NUMBER":n[k]={value:k in l?kb.isNumeric(l[k].value)?l[k].value.toString():"":""};break;case "SUBTABLE":n[k]={value:l[k].value.reduce((e,a)=>{e.push({value:this.simplify(c,a.value)});return e},[])};break;default:n[k]={value:k in l?(l[k].value||" ").toString().replace(/[\r\n]*/g,""):""}}})(f.fields[k]);return n}};
window.KintoneBoosterRecordPicker=class extends KintoneBoosterDialog{constructor(f,l,n){super(999997,!1,!l);this.multiSelect=l;this.prepend=n;this.type=f;this.limit=50;this.offset=0;this.table=null;this.fieldInfo={};this.records=[];this.selection=[];this.img=this.parts.icon.clone().css({top:"0px"});this.prev=this.img.clone().css({right:"4em"}).attr("src","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAFN++nkAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAjZJREFUeNpiYKAJ6J8y8T+MzYIm0QCk6pHFmNA016ObhqKgMCefkfoOBggg6vr9Psz/LLgCBcVb6BI4gxSvQqJMAQggugYDinNYSNVAUDOxHmbCJghNRo2ENDMSG+VASoGq6RMggIY7Agbae6Limdh4ZyGgaT2QCiAphRGbyliwaALZtJ7s5EksYCTF2ehJE6fNUIUbqFIIUFQuYUskAwcAAmgUUTP3F5CUpSi0DD07TqCZxUDLQBXBfVL1sZBpmQCQoiiPsJCRIQWoES3ENAn2AykHaic+Rlr6GF8DgJGWcUx1i4lN1TS1GF8+HpC2FqGSa+QBgAAaRaNgFBBVcJDVm6BCL4uo2ouFShYaAKnzNG/6oFkKstCALm0uarS7mMi0tJ+ujT1i+79UtRhav/ZTKwewUDubULN5S5MRO4KJC9pu+kB3i6GWC4KoAWvQkxL0hFqYJOdjqIET6BLUWCwHBbsg3S2GWv4B6vsLdLUYyQGGQMqQ5omL2IKG6omL3tluFIwCkgFAgPbN6AZAGASi1XQQR3BD3aSrGhLilzZqoQK9iwu8RLnrUfFAEORKbla63NNSRbq21KPZOCQFqJIqC133wAxJt2FU+uZsCHRPF9d+QgFzq7FJlwymgHk/U3pCdgfmgpMm7PL3p5MVIU8bsTQUpbtxcRsxB6xtI9Ka02CaPL7SLdFSLUtrDi2TwJq2ZB5YOni4ApaIlm6Bvx4eQgC/8fVQwE9sLizwnc3hbwMIgobRAdIK28oCHbudAAAAAElFTkSuQmCC").on("click",
k=>{this.offset-=this.limit;this.search()});this.next=this.img.clone().css({right:"2em"}).attr("src","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAFN++nkAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAi1JREFUeNpiYKAa6J8y8T8Q30cXZ0LjK4AU4lMANw3GZkGXLMzJZ2QgpIskABBAVPI/Xr9DA6gBn7/rcUri9DNJACCAaO9lXICRkGZ8HmQkxWZ0g5iIdGEjNhew4NHwAKhBkWaBCxBAwwUBo+o9sWqxRZUAsamMiUDJtJ4szVAQgM8VTMRmFiAOIEszLsBCjCJcOYuQzRvwZUkWUm2jWiIZOAAQQKMIW8QV0MJcRmKyExI3EJjsNgyExchAEeiIBwNhMTIQBDriw0BYDAMfgA4QHAiLkcEBoCMcKSo1aeFjallMchxTYjFFqZpUi6mWjwes5Bp5ACCARtEoGJlNn/+0KESI7RD0U7vRTEpPRADqewN6WwwD54GWnx/Ixh5Z9TBVOn1A8B7osP6BsBgECshplzENVLZjona2JzbbUdtiogdDaGHxB2K69dS2uJDe7WqSBy+o4eMJ5IyYUOpjsksuci2+ALTQkBIXk2OxIdDSC5TGDwuJ2USQWomRidrZZBSMggEHAAHaNaMbAEEYiBLDgo7AJo7gaI7gCI5giMSAn0LLNb0XBuAlhF4LXIQQU3Q/vZfcnsPI2jNPtSZck+e66W/utCjcpPzw/DC4vAjXZPHNk/DbDxT53YvwVz6pvecACNec5aY/vAg3zb5UmUMVFitzFoSHlrklOCMa2OPQI40qLHZpIQmrlKXZwurBI06SnBYtNYUhmgdpYbj2UEIYegAwStjMiIcQQkxxA49895hLUEtfAAAAAElFTkSuQmCC").on("click",
k=>{this.offset+=this.limit;this.search()});this.submit=this.img.clone().css({left:"0"}).attr("src","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAFN++nkAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA7BJREFUeNpiYKAa6J8yMQFK/yfbhP9Qej7RigkpOk+U1QABRLnf92MTZ4LSDkgKHbDpNiDoHZACvIqIChCAAKIIMeLwNtxHhTn5jCTFNHoo4FLPRISZ58mJNQdCwctIauIlKRzwAYAAGqKIkUBcNwIDp4GsRAIqFoC4gBiNAaTmEOQUZkBpWfCeXJtB4AFSMRgAYoNSE9Zyg5R0TVbaRteEnK4JZkn0TAA0rIGcwPxP+4KNWAAQQKO5mVCeg2WdA8DYP0Azi6FZTACILwAtMkQSB4ndxyZHjfbNf2LaE1RNsqBMQ4phUMsdSLEDV04+gBSkRJW3pMY5E45iA2RIIxC/x9cQhEbFeiB2pHqqhlYz/TikHUGOhLZXzpNS6TNSIT2A4nY/MQUuVS0mpibD5gCqt4NwOCARaPkCuhSJ0CyZMFo5wABAAI2iUTCwLRBoLVWAVBI10NRioIUK0JYG0UUhxRaj1TiBQEs2oLWu66FcQaDcB1ItZiHUu8bmK2hQw1op78kp85lw+HY9kUGpiFRnU24xEICaMwSDD+iwBzC3UstiEJhIpBlkta+ZqJAlBahtcT2RZhhQ0+IFxDRvkdrSgVSxGJhoEqHM9wRKs/1Q9RuoGdSCSL2E+WiW7oc5Cpbl8A3Jkduufo8jAT0AWqqIRQ1RDTtSuqmw+PwANPgCWm/CgNRWJTUa9Lja03gtp0Y+xpWi5+Nr3lJsMTRFJ5JqOTV8zAANUpyW08xiIiynncV4LBekW0MO1GQiawxwFAwrABCgXau9QRCIoYQJWMENdAJlBCZQJjCOwAZugE4AG+AGygSs4AjapJra8HF3HEcx96J/jCR91uu1r8+/PDw8/k+FUGw+jzhg9gGGT+iSMjJkLoMwzgxVS5v/xKG1Jp9tA+IfIIDOPDYRMZwRRgnozogq77dxysvZvwE2Z7E4wi17h2yMyMacI5Dl1dTZDjWCixjZZKyiiFm9EAmlmjrDOvMDlc5KE9FhQOwArHU3k1MSpqgtx3FzVbRMCW8tDnURq+AyzjCe108wO4uTZ8GOykNSlYYrqWEBJiMy25Dr7SvRiWs8WuQ7OIOpSveERalg9/j5/exJeqcVYeC7gUIUBd3i+Q9R7N5y8v0n/pDl7IRbyB/e733QvxmAwK+cQE+bSmHFVjC7F5RbVRQwirgI82vPrsE6cTFuXxTPc4NHtYiLszcbEofitlG5JUJphCFbuKdLNR77FM3lZdgw48om0MU49juIO1dMPDw8PJziBXvFttyY+HdhAAAAAElFTkSuQmCC").on("click",
k=>{this.offset=0;this.search()});this.input=this.parts.input.clone().css({paddingLeft:"2em",paddingRight:"4em"}).attr("placeholder",kb.constants.common.prompt.keyword[kb.operator.language]).attr("type","text").on("keydown",k=>{if(13==(k.keyCode||k.which))return this.offset=0,this.search(),k.stopPropagation(),k.preventDefault(),!1});this.container.css({height:"calc(34em + 16px)",minWidth:"16em"});this.contents.css({padding:"0px"});this.header.css({boxShadow:"none"}).append(this.input).append(this.next).append(this.prev).append(this.submit)}search(f){switch(this.type){case "record":kb.api(kb.api.url("/api/records"),
"GET",{app:this.fieldInfo.app,query:(()=>{var l=[];this.fieldInfo.query&&l.push(this.fieldInfo.query);this.input.val()&&l.push((n=>{var k=[];n.each((c,e)=>{for(var a in this.fieldInfo.picker)switch(e=this.fieldInfo.picker[a],e.type){case "LINK":case "MULTI_LINE_TEXT":case "RICH_TEXT":case "SINGLE_LINE_TEXT":k.push(e.code+' like "'+c+'"')}});return 0!=k.length?"("+k.join(" or ")+")":""})(this.input.val().split(/[ \u3000]/).filter(n=>n)));return l.join(" and ")+" order by "+(this.fieldInfo.sort?this.fieldInfo.sort:
"$id asc")+" limit "+this.limit+" offset "+this.offset})()}).then(l=>{this.records=l.records;this.table.clearRows();this.records.each((n,k)=>{(c=>{kb.record.set(c,{fields:this.fieldInfo.picker},n);this.multiSelect&&this.selection.some(e=>e.$id.value==n.$id.value)&&c.css({backgroundColor:"rgba(66,165,245,0.5)",color:""})})(this.table.addRow())});0<this.offset?this.prev.show():this.prev.hide();this.offset+(this.limit==this.records.length?this.limit:this.records.length)<parseInt(l.totalCount)?this.next.show():
this.next.hide();f&&f()}).catch(l=>kb.alert(kb.error.parse(l)));break;default:(()=>{var l=(()=>{var n=this.prepend?this.prepend.concat(kb.roleSet[this.type]):kb.extend({},kb.roleSet[this.type]);this.input.val()&&(k=>{n=n.filter(c=>{var e=!1;c.name.value&&(e=k.some(a=>c.name.value.match(new RegExp(a,"ig"))));return e})})(this.input.val().replace(/[\u3000 ]+/g," ").split(" ").filter(k=>k));return n})();this.records=l.slice(this.offset,this.offset+this.limit);this.table.clearRows();this.records.each((n,
k)=>{(c=>{kb.record.set(c,{fields:this.fieldInfo.picker},n);this.multiSelect&&this.selection.some(e=>e.code.value==n.code.value)&&c.css({backgroundColor:"rgba(66,165,245,0.5)",color:""})})(this.table.addRow())});0<this.offset?this.prev.show():this.prev.hide();this.offset+(this.limit==this.records.length?this.limit:this.records.length)<l.length?this.next.show():this.next.hide();f&&f()})()}}show(f,l){var n=this.parts.div.clone().css({borderTop:"1px solid #42a5f5",borderBottom:"1px solid #42a5f5",lineHeight:"2em",
padding:"0px 0.5em"}),k=this.parts.td.clone().css({cursor:"pointer",padding:"0",userSelect:"none"}),c=this.parts.th.clone().css({backgroundColor:kb.themeColor().backcolor});this.offset=0;this.fieldInfo=f;this.records=[];this.selection=[];this.input.val("");this.table=this.parts.table.clone().css({marginBottom:"0.5em"}).append(kb.create("thead").append(kb.create("tr"))).append(kb.create("tbody").append(kb.create("tr")));for(var e in this.fieldInfo.picker)(a=>{this.table.elm("thead tr").append(c.clone().append(n.clone().html("label"in
a?a.label:"")));var g=this.table.elm("tbody tr"),h=g.append,m=k.clone(),p=m.append,u=kb.field,d=u.create;a=kb.extend({},a);a.noLabel=!0;h.call(g,p.call(m,d.call(u,a).css({width:"100%"}).addClass("kb-picker kb-readonly")))})(this.fieldInfo.picker[e]);this.contents.empty().append(this.table.spread((a,g)=>{a.on("click",h=>{(m=>{this.multiSelect?(p=>{p.length==this.selection.length?(this.selection.push(kb.extend({},m)),a.css({backgroundColor:"rgba(66,165,245,0.5)",color:""})):(this.selection=p,a.css({backgroundColor:"transparent",
color:kb.themeColor().forecolor}))})(this.selection.filter(p=>"record"==this.type?p.$id.value!=m.$id.value:p.code.value!=m.code.value)):(l&&l(m),this.hide())})(this.records[g])});(h=>{a.addClass("kb-scope").elms(".kb-field").each((m,p)=>kb.field.activate(m,h))})({id:"recordPicker",fields:kb.extend({},this.fieldInfo.picker)})}));this.multiSelect&&(this.handler&&this.ok.off("click",this.handler),this.handler=a=>{l&&l(this.selection);this.hide()},this.ok.on("click",this.handler),this.cancel.on("click",
a=>this.hide()));this.search(()=>super.show())}};
window.KintoneBoosterTable=class{constructor(){}activate(f,l){return f.spread((n,k)=>{(c=>{n.elm(".kb-table-row-add").on("click",e=>{f.insertRow(n);kb.event.call("kb.row.add."+f.attr("field-id"),{container:f,record:kb.record.get(c,l,!0).record,rowindex:parseInt(n.attr("row-idx"))+1}).then(a=>{a.error?f.delRow(n):kb.event.call("kb.action.call",{container:c,record:a.record,pattern:"change",field:f.attr("field-id")}).then(g=>{kb.event.call("kb.style.call",{container:c,record:g.record,pattern:"$id"in
g.record?g.record.$id.value?"edit":"create":"create"}).then(h=>{kb.record.set(c,l,h.record);h=new Event("change");c.attr("unsaved","unsaved").dispatchEvent(h)}).catch(()=>{})})})});n.elm(".kb-table-row-copy").on("click",e=>{f.insertRow(n);kb.event.call("kb.row.copy."+f.attr("field-id"),{container:f,record:((a,g)=>{a[f.attr("field-id")].value[g+1]={value:kb.extend({},a[f.attr("field-id")].value[g].value)};return a})(kb.record.get(c,l,!0).record,parseInt(n.attr("row-idx"))),rowindex:parseInt(n.attr("row-idx"))+
1}).then(a=>{a.error?f.delRow(n):kb.event.call("kb.action.call",{container:c,record:a.record,pattern:"change",field:f.attr("field-id")}).then(g=>{kb.event.call("kb.style.call",{container:c,record:g.record,pattern:"$id"in g.record?g.record.$id.value?"edit":"create":"create"}).then(h=>{kb.record.set(c,l,h.record);h=new Event("change");c.attr("unsaved","unsaved").dispatchEvent(h)}).catch(()=>{})})})});n.elm(".kb-table-row-del").on("click",e=>{kb.confirm(kb.constants.common.message.confirm.delete[kb.operator.language],
()=>{kb.event.call("kb.row.del."+f.attr("field-id"),{container:f,record:kb.record.get(c,l,!0).record,rowindex:parseInt(n.attr("row-idx"))}).then(a=>{a.error||(f.delRow(n),kb.event.call("kb.action.call",{container:c,record:kb.record.get(c,l,!0).record,pattern:"change",field:f.attr("field-id")}).then(g=>{kb.event.call("kb.style.call",{container:c,record:g.record,pattern:"$id"in g.record?g.record.$id.value?"edit":"create":"create"}).then(h=>{kb.record.set(c,l,h.record);h=new Event("change");c.attr("unsaved",
"unsaved").dispatchEvent(h)}).catch(()=>{})}))})})});n.elms(".kb-field").each((e,a)=>kb.field.activate(e,l));f.tr.each((e,a)=>e.attr("row-idx",a))})(f.closest("[form-id=form_"+l.id+"]"))},(n,k)=>{0==n.tr.length?n.addRow():n.tr.each((c,e)=>c.attr("row-idx",e))},!1)}create(f,l,n,k,c){return(e=>{n||k||e.append(kb.create("thead").append(kb.create("tr")));e.append(kb.create("tbody").append(kb.create("tr").addClass("kb-scope").attr("row-idx","")));for(var a in f.fields)(g=>{n||k||e.elm("thead tr").append(kb.create("th").append(kb.create("span").html(g.label)));
var h=e.elm("tbody tr"),m=h.append,p=kb.create("td"),u=p.append,d=kb.field,q=d.create;g=kb.extend({},g);k||(g.noLabel=!0);m.call(h,u.call(p,q.call(d,g,c)))})(f.fields[a]);n||k||e.elm("thead tr").append(kb.create("th").addClass("kb-table-button"+(l?" kb-table-button-extension":"")));e.elm("tbody tr").append(kb.create("td").addClass("kb-table-button"+(l?" kb-table-button-extension":"")).append(kb.create("button").addClass("kb-icon kb-icon-add kb-table-row-add")).append(kb.create("button").addClass("kb-icon kb-icon-copy kb-table-row-copy").css({display:l?
"inline-block":"none"})).append(kb.create("button").addClass("kb-icon kb-icon-del kb-table-row-del")));for(a in f.fields)(g=>{g.lookup&&g.lookup.fieldMappings.each((h,m)=>{h.field in f.fields&&e.elm('[field-id="'+CSS.escape(h.field)+'"]')&&e.elm('[field-id="'+CSS.escape(h.field)+'"]').addClass("kb-readonly")})})(f.fields[a]);return e.attr("field-id",f.code)})(kb.create("table").addClass("kb-table"))}};
kb.constants=kb.extend({common:{caption:{button:{cancel:{en:"Cancel",ja:"\u30ad\u30e3\u30f3\u30bb\u30eb",zh:"\u53d6\u6d88"},submit:{en:"Submit",ja:"\u4fdd\u5b58",zh:"\u4fdd\u5b58"}},sort:{asc:{en:"asc",ja:"\u6607\u9806",zh:"\u5347\u5e8f"},desc:{en:"desc",ja:"\u964d\u9806",zh:"\u964d\u5e8f"}}},message:{confirm:{changed:{en:"Changes have not been saved.<br>Do you want to leave the page?",ja:"\u5909\u66f4\u304c\u4fdd\u5b58\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002<br>\u3053\u306e\u307e\u307e\u30da\u30fc\u30b8\u3092\u79fb\u52d5\u3057\u307e\u3059\u304b\uff1f",
zh:"\u66f4\u6539\u5c1a\u672a\u4fdd\u5b58\u3002<br>\u60a8\u662f\u5426\u8981\u79bb\u5f00\u6b64\u9875\u9762\uff1f"},cancel:{en:"The edits you made will be lost. Are you sure?",ja:"\u7de8\u96c6\u3057\u305f\u5185\u5bb9\u304c\u5931\u308f\u308c\u307e\u3059\u304c\u3001\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f",zh:"\u60a8\u7f16\u8f91\u7684\u5185\u5bb9\u5c06\u4f1a\u4e22\u5931\uff0c\u786e\u5b9a\u5417\uff1f"},copy:{en:"Are you sure on copy?",ja:"\u30b3\u30d4\u30fc\u3057\u3066\u3082\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f",
zh:"\u6211\u53ef\u4ee5\u590d\u5236\u5417\uff1f"},delete:{en:"Are you sure on delete?",ja:"\u524a\u9664\u3057\u3066\u3082\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f",zh:"\u6211\u53ef\u4ee5\u5220\u9664\u5417\uff1f"},save:{en:"Are you sure on copy?",ja:"\u4fdd\u5b58\u3057\u3066\u3082\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f",zh:"\u6211\u53ef\u4ee5\u4fdd\u5b58\u5417\uff1f"},submit:{en:"Are you sure on submit?",ja:"\u9001\u4fe1\u3057\u3066\u3082\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f",
zh:"\u6211\u53ef\u4ee5\u53d1\u9001\u5417\uff1f"}},invalid:{record:{en:"There is an error in the input data.",ja:"\u5165\u529b\u5185\u5bb9\u306b\u8aa4\u308a\u304c\u3042\u308a\u307e\u3059\u3002",zh:"\u8f93\u5165\u5185\u5bb9\u6709\u8bef\u3002"},submit:{en:"No data to submit was found.",ja:"\u7de8\u96c6\u4e2d\u306e\u30c7\u30fc\u30bf\u304c\u3042\u308a\u307e\u305b\u3093\u3002",zh:"\u6b63\u5728\u7f16\u8f91\u7684\u6570\u636e\u4e0d\u5b58\u5728\u3002"}}}},picker:{caption:{name:{en:"Name",ja:"\u8868\u793a\u540d",
zh:"\u663e\u793a\u540d\u79f0"},recordnumber:{en:"Record number",ja:"\u30ec\u30b3\u30fc\u30c9\u756a\u53f7",zh:"\u8bb0\u5f55\u53f7"}}}},kb.constants);