/*
* FileName "plugins.style.js"
* Version: 1.0.0
* Copyright (c) 2023 Pandafirm LLC
* Distributed under the terms of the GNU Lesser General Public License.
* https://opensource.org/licenses/LGPL-2.1
*/
(function(v){var c={},B=function(e,g,t){t=void 0===t?"record":t;var u=!1,q=function(){var l={},k=0;if("record"==t)for(var m in g)m in c.fieldInfos.tables&&g[m].value.each(function(f,n){null==f.id&&(k++,f.id=k);l[f.id]=n},{});return l}();return new Promise(function(l,k){var m=function(f,n){var r=function(){f++;f<e.length?m(f,n):n()};(function(p){var h=kb.filter.scan(c.app,g,p.condition.value);h?kb.filter.auth(p.user.value,p.organization.value,p.group.value).then(function(A){if(A&&(p.color.value.map(function(b){return b.value}).each(function(b,
y){b.field.value in c.fieldInfos.parallelize&&function(a){switch(t){case "record":a.tableCode?a.tableCode in h&&function(d){if(c.mobile)d();else if(kb.elms(".subtable-"+c.fieldInfos.tables[a.tableCode].id+" tbody tr").length!=g[a.tableCode].value.length){var w=new MutationObserver(function(){kb.elms(".subtable-"+c.fieldInfos.tables[a.tableCode].id+" tbody tr").length==g[a.tableCode].value.length&&(d(),w.disconnect())});w.observe(kb.elm(".subtable-"+c.fieldInfos.tables[a.tableCode].id),{childList:!0,
subtree:!0})}else d()}(function(){h[a.tableCode].value.each(function(d,w){if(a.code in d.value){var x=kb.field.get(a,c.mobile,c.type);x&&(x[q[d.id]].value.css({backgroundColor:b.backcolor.value,color:b.forecolor.value}),b.backcolor.value?x[q[d.id]].value.addClass("kb-inherit-backcolor"):x[q[d.id]].value.removeClass("kb-inherit-backcolor"),b.forecolor.value?x[q[d.id]].value.addClass("kb-inherit-forecolor"):x[q[d.id]].value.removeClass("kb-inherit-forecolor"))}})}):a.code in h&&function(d){d&&(d.value.css({backgroundColor:b.backcolor.value,
color:b.forecolor.value}),b.backcolor.value?d.value.addClass("kb-inherit-backcolor"):d.value.removeClass("kb-inherit-backcolor"),b.forecolor.value?d.value.addClass("kb-inherit-forecolor"):d.value.removeClass("kb-inherit-forecolor"))}(kb.field.get(a,c.mobile,c.type));break;case "view":a.tableCode?a.tableCode in h&&h[a.tableCode].value.each(function(d,w){a.code in d.value&&(d.value[a.code].backcolor=b.backcolor.value,d.value[a.code].forecolor=b.forecolor.value)}):a.code in h&&(h[a.code].backcolor=b.backcolor.value,
h[a.code].forecolor=b.forecolor.value)}}(c.fieldInfos.parallelize[b.field.value])}),p.display.value.map(function(b){return b.value}).each(function(b,y){switch(t){case "record":(c.mobile?kintone.mobile.app.record:kintone.app.record).setFieldShown(b.field.value,"show"==b.state.value);break;case "view":b.field.value in c.fieldInfos.groups?c.fieldInfos.groups[b.field.value].fields.map(function(a){return a.code}).each(function(a,d){a in c.fieldInfos.parallelize&&a in h&&(h[a].hidden="hide"==b.state.value)}):
b.field.value in c.fieldInfos.tables?b.field.value in h&&(h[b.field.value].hidden="hide"==b.state.value):function(a){a.tableCode?a.tableCode in h&&h[a.tableCode].value.each(function(d,w){a.code in d.value&&(d.value[a.code].hidden="hide"==b.state.value)}):a.code in h&&(h[a.code].hidden="hide"==b.state.value)}(c.fieldInfos.parallelize[b.field.value])}}),p.toggle.value.map(function(b){return b.value}).each(function(b,y){switch(t){case "record":(c.mobile?kintone.mobile.app.record:kintone.app.record).setGroupFieldOpen(b.field.value,
"open"==b.state.value)}}),["create","edit"].includes(c.type))){var z={};p.editable.value.map(function(b){return b.value}).each(function(b,y){b.field.value in c.fieldInfos.parallelize&&function(a){c.fieldInfos.disables.includes(a.code)||(a.tableCode?a.tableCode in h&&(h[a.tableCode].value.each(function(d,w){a.code in d.value&&(d.value[a.code].disabled="disable"==b.state.value)}),z[a.code]=g[a.tableCode].value.map(function(d){return d.value[a.code].disabled?"disabled":""})):a.code in h&&(h[a.code].disabled=
"disable"==b.state.value,z[a.code]=g[a.code].disabled?"disabled":""))}(c.fieldInfos.parallelize[b.field.value])});if(p.latest&&p.latest==JSON.stringify(z)){r();return}u=Object.values(z).some(function(b){return Array.isArray(b)?b.some(function(y){return"disabled"==y}):"disabled"==b});p.latest=JSON.stringify(z)}r()})["catch"](function(A){kb.alert(kb.error.parse(A));k()}):r()})(e[f])};m(0,function(){return l({performed:u})})})};kintone.events.on("app.record.create.show app.record.detail.show app.record.edit.show app.record.print.show mobile.app.record.create.show mobile.app.record.detail.show mobile.app.record.edit.show".split(" "),
function(e){return new Promise(function(g,t){(function(u,q){c.mobile=u;c.type=q;kb.config[v].config.get().then(function(l){0!=Object.keys(l).length?(e.reuse&&function(k){"reusecolor"in k&&k.reusecolor.value&&kintone.app.record.getHeaderMenuSpaceElement().nextSibling.firstElementChild.css({backgroundColor:k.reusecolor.value})}(JSON.parse(l.flat)),kb.field.load(kb.config[v].app,!0).then(function(k){c.app={id:kb.config[v].app,fields:k.origin};c.fieldInfos=k;try{(function(m){if(0!=m.length){if(["create",
"edit"].includes(c.type))kintone.events.on(k.changes.reduce(function(f,n){f.push("app.record.create.change."+n);f.push("app.record.edit.change."+n);f.push("mobile.app.record.create.change."+n);f.push("mobile.app.record.edit.change."+n);return f},[]),function(f){if(function(){var n=!0;["DATETIME","TIME"].includes(f.changes.field.type)&&function(r){r&&(Array.isArray(r)?r:[r]).each(function(p,h){p.elm(".control-errors-content-gaia")&&(n=!1)})}(kb.field.get(c.fieldInfos.parallelize[f.type.split(".").last()],
c.mobile,c.type));return n}())return kb.event.call("kb.action.installed",{installed:!1,mobile:c.mobile}).then(function(n){n.installed||B(m,f.record,"record").then(function(r){r.performed&&(c.mobile?kintone.mobile.app.record:kintone.app.record).set(f)})["catch"](function(){})}),f});B(m,e.record,"record").then(function(f){return g(e)})["catch"](function(){})}else g(e)})((c.config?c.config:c.config=JSON.parse(l.tab)).reduce(function(m,f){(c.mobile?["both","mobile"]:["both","pc"]).includes(f.setting.device.value)&&
f.setting.page.value.includes(c.type)&&m.push(f.setting);return m},[]))}catch(m){kb.alert(kb.error.parse(m)),g(e)}})["catch"](function(k){return g(e)})):g(e)})["catch"](function(l){return g(e)})})("mobile"==e.type.split(".").first(),e.type.split(".").slice(-2).first())})});kb.event.on("kb.style.call",function(e){return new Promise(function(g,t){kb.config[v].config.get().then(function(u){0!=Object.keys(u).length?kb.field.load(kb.config[v].app,!0).then(function(q){c.app={id:kb.config[v].app,fields:q.origin};
c.fieldInfos=q;try{(function(l){0!=l.length?B(l,e.record,e.workplace?e.workplace:"record").then(function(k){e.performed=k.performed;g(e)})["catch"](function(){return g(e)}):g(e)})((c.config?c.config:c.config=JSON.parse(u.tab)).reduce(function(l,k){(e.mobile?["both","mobile"]:["both","pc"]).includes(k.setting.device.value)&&k.setting.page.value.includes(e.pattern)&&l.push(k.setting);return l},[]))}catch(l){kb.alert(kb.error.parse(l)),g(e)}})["catch"](function(q){return g(e)}):g(e)})["catch"](function(u){return g(e)})})})})(kintone.$PLUGIN_ID);