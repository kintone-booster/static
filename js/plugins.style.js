/*
* FileName "plugins.style.js"
* Version: 1.0.0
* Copyright (c) 2023 Pandafirm LLC
* Distributed under the terms of the GNU Lesser General Public License.
* https://opensource.org/licenses/LGPL-2.1
*/
(function(v){var b={},B=function(e,g,u,p){p=void 0===p?"record":p;var q=function(){var l={},h=0;if("record"==p)for(var n in g)n in b.fieldInfos.tables&&g[n].value.each(function(f,m){null==f.id&&(h++,f.id=h);l[f.id]=m},{});return l}();return new Promise(function(l,h){var n={},f=function(m,r){var y=function(){m++;m<e.length?f(m,r):r()};(function(t){var k=kb.filter.scan(b.app,g,t.condition.value);k?kb.filter.auth(t.user.value,t.organization.value,t.group.value).then(function(z){z&&(t.color.value.map(function(c){return c.value}).each(function(c,
A){c.field.value in b.fieldInfos.parallelize&&function(a){switch(p){case "record":a.tableCode?a.tableCode in k&&function(d){if(b.mobile)d();else if(kb.elms(".subtable-"+b.fieldInfos.tables[a.tableCode].id+" tbody tr").length!=g[a.tableCode].value.length){var w=new MutationObserver(function(){kb.elms(".subtable-"+b.fieldInfos.tables[a.tableCode].id+" tbody tr").length==g[a.tableCode].value.length&&(d(),w.disconnect())});w.observe(kb.elm(".subtable-"+b.fieldInfos.tables[a.tableCode].id),{childList:!0,
subtree:!0})}else d()}(function(){k[a.tableCode].value.each(function(d,w){if(a.code in d.value){var x=kb.field.get(a,b.mobile,b.type);x&&(x[q[d.id]].value.css({backgroundColor:c.backcolor.value,color:c.forecolor.value}),c.backcolor.value?x[q[d.id]].value.addClass("kb-inherit-backcolor"):x[q[d.id]].value.removeClass("kb-inherit-backcolor"),c.forecolor.value?x[q[d.id]].value.addClass("kb-inherit-forecolor"):x[q[d.id]].value.removeClass("kb-inherit-forecolor"))}})}):a.code in k&&function(d){d&&(d.value.css({backgroundColor:c.backcolor.value,
color:c.forecolor.value}),c.backcolor.value?d.value.addClass("kb-inherit-backcolor"):d.value.removeClass("kb-inherit-backcolor"),c.forecolor.value?d.value.addClass("kb-inherit-forecolor"):d.value.removeClass("kb-inherit-forecolor"))}(kb.field.get(a,b.mobile,b.type));break;case "view":a.tableCode?a.tableCode in k&&k[a.tableCode].value.each(function(d,w){a.code in d.value&&(d.value[a.code].backcolor=c.backcolor.value,d.value[a.code].forecolor=c.forecolor.value)}):a.code in k&&(k[a.code].backcolor=c.backcolor.value,
k[a.code].forecolor=c.forecolor.value)}}(b.fieldInfos.parallelize[c.field.value])}),t.display.value.map(function(c){return c.value}).each(function(c,A){switch(p){case "record":(b.mobile?kintone.mobile.app.record:kintone.app.record).setFieldShown(c.field.value,"show"==c.state.value);break;case "view":c.field.value in b.fieldInfos.groups?b.fieldInfos.groups[c.field.value].fields.map(function(a){return a.code}).each(function(a,d){a in b.fieldInfos.parallelize&&a in k&&(k[a].hidden="hide"==c.state.value)}):
c.field.value in b.fieldInfos.tables?c.field.value in k&&(k[c.field.value].hidden="hide"==c.state.value):function(a){a.tableCode?a.tableCode in k&&k[a.tableCode].value.each(function(d,w){a.code in d.value&&(d.value[a.code].hidden="hide"==c.state.value)}):a.code in k&&(k[a.code].hidden="hide"==c.state.value)}(b.fieldInfos.parallelize[c.field.value])}}),t.toggle.value.map(function(c){return c.value}).each(function(c,A){switch(p){case "record":(b.mobile?kintone.mobile.app.record:kintone.app.record).setGroupFieldOpen(c.field.value,
"open"==c.state.value)}}),["create","edit"].includes(b.type)&&t.editable.value.map(function(c){return c.value}).each(function(c,A){c.field.value in b.fieldInfos.parallelize&&function(a){b.fieldInfos.disables.includes(a.code)||(a.tableCode?a.tableCode in k&&(k[a.tableCode].value.each(function(d,w){a.code in d.value&&(d.value[a.code].disabled="disable"==c.state.value)}),n[a.code]=g[a.tableCode].value.map(function(d){return d.value[a.code].disabled?"disabled":""})):a.code in k&&(k[a.code].disabled="disable"==
c.state.value,n[a.code]=g[a.code].disabled?"disabled":""))}(b.fieldInfos.parallelize[c.field.value])}));y()})["catch"](function(z){kb.alert(kb.error.parse(z));h()}):y()})(e[m])};f(0,function(){u.latest?u.latest.style||(u.latest.style="{}"):u.latest={style:"{}"};var m=JSON.stringify(n),r=u.latest.style!=m;u.latest.style=m;l({performed:r})})})};kintone.events.on("app.record.create.show app.record.detail.show app.record.edit.show app.record.print.show mobile.app.record.create.show mobile.app.record.detail.show mobile.app.record.edit.show".split(" "),
function(e){return new Promise(function(g,u){(function(p,q){b.mobile=p;b.type=q;kb.config[v].config.get().then(function(l){0!=Object.keys(l).length?(e.reuse&&function(h){"reusecolor"in h&&h.reusecolor.value&&kintone.app.record.getHeaderMenuSpaceElement().nextSibling.firstElementChild.css({backgroundColor:h.reusecolor.value})}(JSON.parse(l.flat)),kb.field.load(kb.config[v].app,!0).then(function(h){b.app={id:kb.config[v].app,fields:h.origin};b.fieldInfos=h;try{(function(n){if(0!=n.length){if(["create",
"edit"].includes(b.type))kintone.events.on(h.changes.reduce(function(f,m){f.push("app.record.create.change."+m);f.push("app.record.edit.change."+m);f.push("mobile.app.record.create.change."+m);f.push("mobile.app.record.edit.change."+m);return f},[]),function(f){if(function(){var m=!0;["DATETIME","TIME"].includes(f.changes.field.type)&&function(r){r&&(Array.isArray(r)?r:[r]).each(function(y,t){y.elm(".control-errors-content-gaia")&&(m=!1)})}(kb.field.get(b.fieldInfos.parallelize[f.type.split(".").last()],
b.mobile,b.type));return m}())return kb.event.call("kb.action.installed",{installed:!1,mobile:b.mobile}).then(function(m){m.installed||B(n,f.record,kb.elm("body"),"record").then(function(r){r.performed&&(b.mobile?kintone.mobile.app.record:kintone.app.record).set(f)})["catch"](function(){})}),f});B(n,e.record,kb.elm("body"),"record").then(function(f){return g(e)})["catch"](function(){})}else g(e)})((b.config?b.config:b.config=JSON.parse(l.tab)).map(function(n,f){return kb.extend({sIndex:{value:f.toString()}},
n)}).reduce(function(n,f){(b.mobile?["both","mobile"]:["both","pc"]).includes(f.setting.device.value)&&f.setting.page.value.includes(b.type)&&n.push(f.setting);return n},[]))}catch(n){kb.alert(kb.error.parse(n)),g(e)}})["catch"](function(h){return g(e)})):g(e)})["catch"](function(l){return g(e)})})("mobile"==e.type.split(".").first(),e.type.split(".").slice(-2).first())})});kb.event.on("kb.style.call",function(e){return new Promise(function(g,u){kb.config[v].config.get().then(function(p){0!=Object.keys(p).length?
kb.field.load(kb.config[v].app,!0).then(function(q){b.app={id:kb.config[v].app,fields:q.origin};b.fieldInfos=q;try{(function(l){0!=l.length?B(l,e.record,e.container,e.workplace?e.workplace:"record").then(function(h){e.performed=h.performed;g(e)})["catch"](function(){return g(e)}):g(e)})((b.config?b.config:b.config=JSON.parse(p.tab)).map(function(l,h){return kb.extend({sIndex:{value:h.toString()}},l)}).reduce(function(l,h){(e.mobile?["both","mobile"]:["both","pc"]).includes(h.setting.device.value)&&
h.setting.page.value.includes(e.pattern)&&l.push(h.setting);return l},[]))}catch(l){kb.alert(kb.error.parse(l)),g(e)}})["catch"](function(q){return g(e)}):g(e)})["catch"](function(p){return g(e)})})})})(kintone.$PLUGIN_ID);