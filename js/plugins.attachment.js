/*
* FileName "plugins.attachment.js"
* Version: 1.0.0
* Copyright (c) 2023 Pandafirm LLC
* Distributed under the terms of the GNU Lesser General Public License.
* https://opensource.org/licenses/LGPL-2.1
*/
'use strict';(E=>{var d={handlers:{}},I=b=>{var q={};if(b.useMultiline.value.includes("use")&&!d.mobile)for(var F in d.fieldInfos.tables)(A=>{var B=Object.keys(A.fields).filter(y=>b.multilines.value.map(v=>v.value.field.value).includes(y));B.length!=0&&(q[A.id]={tableInfo:A,lines:Object.keys(A.fields).reduce((y,v)=>{B.includes(v)&&y.last().length!=0&&y.push([]);y.last().push(d.fieldInfos.parallelize[v].id);return y},[[]])})})(d.fieldInfos.tables[F]);return[b,q]},J=(b,q,F)=>{["create","edit"].includes(d.type)&&
F.each((A,B)=>{((y,v)=>{kintone.events.on(y,v);y.each((u,C)=>{u in d.handlers||(d.handlers[u]=[]);d.handlers[u].push(v)})})(["app.record.create.change."+b.code,"app.record.edit.change."+b.code],A)});if(kb.elms(".subtable-"+b.id+" tbody tr").length!=q[b.code].value.length&&q[b.code].value.length!=0){let A=new MutationObserver(()=>{kb.elms(".subtable-"+b.id+" tbody tr").length==q[b.code].value.length&&(F.each((B,y)=>B({record:q})),A.disconnect())});A.observe(kb.elm(".subtable-"+b.id),{childList:!0,
subtree:!0})}else F.each((A,B)=>A({record:q}))};kintone.events.on(["app.record.create.show","app.record.edit.show","mobile.app.record.create.show","mobile.app.record.edit.show"],b=>new Promise((q,F)=>{((A,B)=>{d.mobile=A;d.type=B;for(var y in d.handlers)d.handlers[y].each((v,u)=>{kintone.events.off(y,v)});kb.config[E].config.get().then(v=>{Object.keys(v).length!=0?kb.field.load(kb.config[E].app,!0).then(u=>{d.app={id:kb.config[E].app,fields:u.origin};d.fieldInfos=u;try{(([C,D])=>{var m={};C.useLookupNavi.value.includes("use")&&
Object.values(d.fieldInfos.parallelize).filter(n=>n.lookup).each((n,p)=>{(h=>{if(n.tableCode){var l=d.fieldInfos.tables[n.tableCode];l.code in m||(m[l.code]=[]);m[l.code].push(h)}else h({record:b.record})})(h=>{(l=>{l&&(Array.isArray(l)?l:[l]).each((k,a)=>{k.value.parentNode.elm(".kb-attachment-lookup-operation")||k.value.parentNode.css({alignItems:"center"}).insertBefore(kb.create("button").addClass("kb-icon kb-icon-open kb-attachment-lookup-operation").on("click",x=>{((c,e)=>{c?kb.view.records.get(e,
kb.filter.query.create({code:n.lookup.relatedKeyField},"=",{type:n.type,value:c})).then(r=>{r.length!=0&&window.open(kb.record.page.detail(d.mobile,e,r.first().$id.value))}).catch(r=>kb.alert(kb.error.parse(r))):window.open(kb.record.page.add(d.mobile,e))})(k.value.elm("input[type=text]").val(),n.lookup.relatedApp.app)}),k.value.nextSibling)})})(kb.field.get(n,d.mobile,d.type))})});C.usePlaceholder.value.includes("use")&&C.placeholders.value.map(n=>n.value).each((n,p)=>{n.field.value in d.fieldInfos.parallelize&&
(h=>{(l=>{if(h.tableCode){var k=d.fieldInfos.tables[h.tableCode];k.code in m||(m[k.code]=[]);m[k.code].push(l)}else l({record:b.record})})(l=>{(k=>{k&&(Array.isArray(k)?k:[k]).each((a,x)=>{d.mobile?a.value.attr("placeholder",n.text.value):a.value.elm("input[type=text],textarea").attr("placeholder",n.text.value)})})(kb.field.get(h,d.mobile,d.type))})})(d.fieldInfos.parallelize[n.field.value])});C.useAlignTableButtons.value.includes("use")&&!d.mobile&&Object.values(u.tables).filter(n=>!Object.keys(D).includes(n.id)).each((n,
p)=>{((h,l)=>{b.record[h.code].value.length!=0&&((k=>{k.prepend(k.elm('[class^="subtable-operation-gaia"]'))})(l.addClass("kb-attachment-subtable-operation").elm("thead").elm("tr")),h.code in m||(m[h.code]=[]),m[h.code].push(k=>{l.elms("tbody tr").each((a,x)=>{Array.from(a.elms("td").last().classList).some(c=>c.startsWith("subtable-operation-gaia"))&&a.prepend(a.elm('[class^="subtable-operation-gaia"]'))})}))})(n,kb.elm(".subtable-"+n.id))});if(C.useMultiline.value.includes("use")&&!d.mobile)for(var g in D)((n,
p)=>{var h=(l,k,a)=>{k.elms("tr").each((x,c)=>{x.hasClass("kb-attachment-subtable-multi")||(e=>{C.useAlignTableButtons.value.includes("use")?x.addClass("kb-attachment-subtable-multi").append(e):x.addClass("kb-attachment-subtable-multi").prepend(e);l.lines.each((r,t)=>{e.append((w=>{r.each((f,z)=>{var G={};z==r.length-1&&(G.flex="1");a?f?w.append(x.elm(".label-"+f).addClass("kb-attachment-subtable-multi-cell").css(G)):w.append(kb.create("th").addClass("subtable-label-gaia kb-attachment-subtable-multi-cell").css(G)):
(G.width=p.elm("thead").elm(".label-"+f).css("width"),f?w.append(x.elm(".field-"+f).closest("td").addClass("kb-attachment-subtable-multi-cell").css(G)):w.append(kb.create("td").addClass("kb-attachment-subtable-multi-cell").css(G)))});return w})(kb.create("div").css({alignItems:"stretch",display:"flex"})))})})(a?kb.create("th").addClass("subtable-label-gaia"):kb.create("td"))})};b.record[n.tableInfo.code].value.length!=0&&(C.useAlignTableButtons.value.includes("use")&&p.addClass("kb-attachment-subtable-operation"),
h(n,p.elm("thead"),!0),n.tableInfo.code in m||(m[n.tableInfo.code]=[]),m[n.tableInfo.code].push(l=>{h(n,p.elm("tbody"),!1)}))})(D[g],kb.elm(".subtable-"+D[g].tableInfo.id));for(g in m)J(d.fieldInfos.tables[g],b.record,m[g])})(I(JSON.parse(v.flat))),q(b)}catch(C){kb.alert(kb.error.parse(C)),q(b)}}).catch(u=>q(b)):q(b)}).catch(v=>q(b))})(b.type.split(".").first()=="mobile",b.type.split(".").slice(-2).first())}));kintone.events.on(["app.record.detail.show","mobile.app.record.detail.show"],b=>new Promise((q,
F)=>{((A,B)=>{d.mobile=A;d.type=B;kb.config[E].config.get().then(y=>{Object.keys(y).length!=0?kb.field.load(kb.config[E].app,!0).then(v=>{d.app={id:kb.config[E].app,fields:v.origin};d.fieldInfos=v;try{(([u,C])=>{var D={};u.useAttachmentViewer.value.includes("use")&&Object.values(d.fieldInfos.parallelize).filter(g=>g.type=="FILE").each((g,n)=>{(p=>{if(g.tableCode){var h=d.fieldInfos.tables[g.tableCode];h.code in D||(D[h.code]=[]);D[h.code].push(p)}else p({record:b.record})})(p=>{(h=>{h&&(Array.isArray(h)?
h:[h]).each((l,k)=>{(a=>{(d.mobile?kb.children(l.value):l.value.elm("ul").elms("li")).each((x,c)=>{x.elm("a")&&(e=>{e.length!=0&&(x.prepend(kb.create("span").addClass("kb-attachment-file-operation").html(e.first().name).on("click",r=>kb.attachment.show(e.first(),!u.onlyView.value.includes("onlyView")))),a=a.filter(r=>r!=e.first()))})(a.filter(e=>e.name==x.elm("a").html()))})})(g.tableCode?p.record[g.tableCode].value[k].value[g.code].value:p.record[g.code].value)})})(kb.field.get(g,d.mobile,d.type))})});
if(u.useMultiline.value.includes("use")&&!d.mobile)for(var m in C)((g,n)=>{var p=(h,l,k)=>{l.elms("tr").each((a,x)=>{a.hasClass("kb-attachment-subtable-multi")||(c=>{a.addClass("kb-attachment-subtable-multi").prepend(c);h.lines.each((e,r)=>{c.append((t=>{e.each((w,f)=>{var z={};f==e.length-1&&(z.flex="1");k?w?t.append(a.elm(".label-"+w).addClass("kb-attachment-subtable-multi-cell").css(z)):t.append(kb.create("th").addClass("subtable-label-gaia kb-attachment-subtable-multi-cell").css(z)):(z.width=
n.elm("thead").elm(".label-"+w).css("width"),w?t.append(a.elm(".field-"+w).closest("td").addClass("kb-attachment-subtable-multi-cell").css(z)):t.append(kb.create("td").addClass("kb-attachment-subtable-multi-cell").css(z)))});return t})(kb.create("div").css({alignItems:"stretch",display:"flex"})))})})(k?kb.create("th").addClass("subtable-label-gaia"):kb.create("td"))})};b.record[g.tableInfo.code].value.length!=0&&(p(g,n.elm("thead"),!0),g.tableInfo.code in D||(D[g.tableInfo.code]=[]),D[g.tableInfo.code].push(h=>
{p(g,n.elm("tbody"),!1)}))})(C[m],kb.elm(".subtable-"+C[m].tableInfo.id));for(m in D)J(d.fieldInfos.tables[m],b.record,D[m])})(I(JSON.parse(y.flat))),q(b)}catch(u){kb.alert(kb.error.parse(u)),q(b)}}).catch(v=>q(b)):q(b)}).catch(y=>q(b))})(b.type.split(".").first()=="mobile",b.type.split(".").slice(-2).first())}));kintone.events.on(["app.record.index.show","mobile.app.record.index.show"],b=>new Promise((q,F)=>{((A,B)=>{d.mobile=A;d.type=B;kb.config[E].config.get().then(y=>{Object.keys(y).length!=0?
kb.field.load(kb.config[E].app,!0).then(v=>{d.app={id:kb.config[E].app,fields:v.origin};d.fieldInfos=v;try{(u=>{var C=()=>{u.useSearchBox.value.includes("use")&&b.viewType=="list"?kb.view.load(d.app.id).then(D=>{(m=>{kb.roleSet.user.length==0?kb.roleSet.load().then(()=>m()):m()})(()=>{(m=>{var g=(()=>{var p={},h={},l=(a=>Object.keys(a).reduce((x,c)=>{a[c]!="NONE"&&x.push(c);return x},[]))(cybozu.data.page.FIELD_ACCESSIBILITY||cybozu.data.page.FIELD_ACCESS_CONTROL.right.fields),k=a=>{var x={CREATED_AT:"CREATED_TIME",
DECIMAL:"NUMBER",EDITOR:"RICH_TEXT",MODIFIED_AT:"UPDATED_TIME",MULTIPLE_CHECK:"CHECK_BOX",MULTIPLE_SELECT:"MULTI_SELECT",MULTIPLE_LINE_TEXT:"MULTI_LINE_TEXT",RECORD_ID:"RECORD_NUMBER",SINGLE_CHECK:"RADIO_BUTTON",SINGLE_SELECT:"DROP_DOWN"};return a in x?x[a]:a};Object.values(cybozu.data.page.FORM_DATA.schema.table.fieldList).each((a,x)=>{if(l.includes(a.id))if(a.type=="REFERENCE_TABLE")h[a.id]=a.var;else switch(p[a.var]={id:"f"+a.id,type:k(a.type)},p[a.var].type){case "CHECK_BOX":case "DROP_DOWN":case "MULTI_SELECT":case "RADIO_BUTTON":p[a.var].option=
(()=>{var c={};"options"in a.properties&&Array.isArray(a.properties.options)&&a.properties.options.each((e,r)=>{e.valid&&(c[e.label]=e.id)});return c})();break;case "STATUS":p[a.var].status=(()=>{var c={};(e=>{(typeof e.useStatus==="string"?e.useStatus=="true":e.useStatus)&&e.states.each((r,t)=>{r.valid&&(c[r.label]=r.id)})})(cybozu.data.page.STATUS_DATA);return c})()}});Object.values(cybozu.data.page.FORM_DATA.schema.subTable).map(a=>Object.values(a.fieldList)).flat().each((a,x)=>{if(l.includes(a.id))switch(p[a.var]=
{id:"f"+a.id,type:k(a.type)},p[a.var].type){case "CHECK_BOX":case "DROP_DOWN":case "MULTI_SELECT":case "RADIO_BUTTON":p[a.var].option=(()=>{var c={};"options"in a.properties&&Array.isArray(a.properties.options)&&a.properties.options.each((e,r)=>{e.valid&&(c[e.label]=e.id)});return c})()}});cybozu.data.page.FORM_DATA.referenceTables.each((a,x)=>{a.masterApp.schema&&l.includes(a.fieldId)&&((c,e,r)=>{Object.values(a.masterApp.schema.table.fieldList).each((t,w)=>{if(!c.includes(t.id))switch(p[h[e]+"."+
t.var]={id:"f"+e+".f"+t.id,type:k(t.type)},p[h[e]+"."+t.var].type){case "CHECK_BOX":case "DROP_DOWN":case "MULTI_SELECT":case "RADIO_BUTTON":p[h[e]+"."+t.var].option=(()=>{var f={};"options"in t.properties&&Array.isArray(t.properties.options)&&t.properties.options.each((z,G)=>{z.valid&&(f[z.label]=z.id)});return f})();break;case "STATUS":p[h[e]+"."+t.var].status=(()=>{var f={};(typeof r.useStatus==="string"?r.useStatus=="true":r.useStatus)&&r.states.each((z,G)=>{z.valid&&(f[z.label]=z.id)});return f})()}})})(a.masterApp.unAccessibleFieldIds,
a.fieldId,a.masterApp.status)});return p})(),n={build:p=>{var h=m.filterCond.match(/ and /g)?" and ":" or ",l=m.filterCond.split(h).filter(a=>a),k=(a,x)=>{l.length!=0?(c=>{if(c.info){var e=RegExp("[/\\\\^$*+?.()|[\\]{}]","g"),r=function(w){var f={groups:[],organizations:[],users:[]},z="";w.match(/ in /g)&&(G=>{G.each((H,K)=>{if(H.replace(/^[ ]+/g,"").replace(/[ ]+$/g,"").match(/^"/g))switch(H=H.replace(/^[ "]+/g,"").replace(/[ "]+$/g,""),H){case "GROUP":z="groups";break;case "ORGANIZATION":z="organizations";
break;case "USER":z="users";break;default:z||="users",f[z].push(H)}})})(w.split(" in ").last().replace(/^\(/g,"").replace(/\)$/g,"").split(","));return f};switch(c.info.type){case "CHECK_BOX":case "DROP_DOWN":case "MULTI_SELECT":case "RADIO_BUTTON":for(var t in c.info.option)c.query.match(new RegExp('"'+t.replace(e,"\\$&")+'"'))&&(c.query=c.query.replace(new RegExp('"'+t.replace(e,"\\$&")+'"'),'"'+c.info.option[t]+'"'));break;case "CREATOR":case "MODIFIER":case "USER_SELECT":(w=>{kb.roleSet.group.filter(f=>
w.groups.includes(f.code.value)).each((f,z)=>{c.query.match(new RegExp('"'+f.code.value.replace(e,"\\$&")+'"'))&&(c.query=c.query.replace(new RegExp('"'+f.code.value.replace(e,"\\$&")+'"'),'"'+f.info.id+'"'))});kb.roleSet.organization.filter(f=>w.organizations.includes(f.code.value)).each((f,z)=>{c.query.match(new RegExp('"'+f.code.value.replace(e,"\\$&")+'"'))&&(c.query=c.query.replace(new RegExp('"'+f.code.value.replace(e,"\\$&")+'"'),'"'+f.info.id+'"'))});kb.roleSet.user.filter(f=>w.users.includes(f.code.value)).each((f,
z)=>{c.query.match(new RegExp('"'+f.code.value.replace(e,"\\$&")+'"'))&&(c.query=c.query.replace(new RegExp('"'+f.code.value.replace(e,"\\$&")+'"'),'"'+f.info.id+'"'))})})(r(c.query));break;case "GROUP_SELECT":(w=>{kb.roleSet.group.filter(f=>w.groups.includes(f.code.value)).each((f,z)=>{c.query.match(new RegExp('"'+f.code.value.replace(e,"\\$&")+'"'))&&(c.query=c.query.replace(new RegExp('"'+f.code.value.replace(e,"\\$&")+'"'),'"'+f.info.id+'"'))})})(r(c.query));break;case "ORGANIZATION_SELECT":(w=>
{kb.roleSet.organization.filter(f=>w.organizations.includes(f.code.value)).each((f,z)=>{c.query.match(new RegExp('"'+f.code.value.replace(e,"\\$&")+'"'))&&(c.query=c.query.replace(new RegExp('"'+f.code.value.replace(e,"\\$&")+'"'),'"'+f.info.id+'"'))})})(r(c.query));break;case "STATUS":for(t in c.info.status)c.query.match(new RegExp('"'+t.replace(e,"\\$&")+'"'))&&(c.query=c.query.replace(new RegExp('"'+t.replace(e,"\\$&")+'"'),'"'+c.info.status[t]+'"'))}l[a]=c.query}else l[a]="";a++;a<l.length?k(a,
x):x(l.filter(w=>w).join(h))})((c=>{var e={info:null,query:""};c.length>1&&c.last()in g&&(e.info=g[c.last()],e.query=l[a].replace(new RegExp(c.last().replace(/[\/\\^$*+?.()|\[\]{}]/g,"\\$&")),e.info.id));return e})(l[a].match(/^([^ ]+)/))):x("")};k(0,a=>{p(a)})},search:p=>{var h=kb.elm(".kb-attachment-search-operation").elm(".kb-keyword").elm("input"),l=kb.elm(".kb-attachment-search-operation").elm(".kb-target").elm("select"),k=kintone.api.url("/k/",!0).replace(/\.json/g,"")+(d.mobile?"m/"+d.app.id:
d.app.id)+"/?view="+b.viewId.toString();if(h.val()){var a=(x=>{var c=(l.val()?[m.fields[l.val()]]:Object.values(m.fields)).reduce((e,r)=>{e.push(x.map(t=>{var w=t.match(/^!/g);t=t.replace(/^!/g,"");var f="";if(t=="EMPTY")switch(r.type){case "CHECK_BOX":case "DROP_DOWN":case "MULTI_SELECT":case "RADIO_BUTTON":case "STATUS":f=g[r.code].id+(w?" not":"")+' in ("")';break;case "FILE":case "LINK":case "MULTI_LINE_TEXT":case "RICH_TEXT":case "SINGLE_LINE_TEXT":f=g[r.code].id+(w?" !":" ")+'= ""'}else switch(r.type){case "CHECK_BOX":case "DROP_DOWN":case "MULTI_SELECT":case "RADIO_BUTTON":t in
g[r.code].option&&(f=g[r.code].id+(w?" not":"")+' in ("'+g[r.code].option[t].replace(/"/g,'\\"')+'")');break;case "FILE":case "LINK":case "MULTI_LINE_TEXT":case "RICH_TEXT":case "SINGLE_LINE_TEXT":f=g[r.code].id+(w?" not":"")+' like "'+t.replace(/"/g,'\\"')+'"';break;case "STATUS":t in g[r.code].status&&(f=g[r.code].id+(w?" not":"")+' in ("'+g[r.code].status[t].replace(/"/g,'\\"')+'")')}return f}).join(" or "));return e.filter(t=>t)},[]).map(e=>"("+e+")");return p?["("+p+")"].concat(c.join(" or ")).join(" and "):
c.join(" or ")})(h.val().split(/[ \u3000]/).filter(x=>x));window.location.href=a?k+"&keyword="+h.val()+"&target="+l.val()+"&q="+encodeURIComponent(a):k}else window.location.href=k}};m.fields=m.fields.reduce((p,h)=>{if(h in g)switch(d.fieldInfos.parallelize[h].type){case "CHECK_BOX":case "DROP_DOWN":case "FILE":case "LINK":case "MULTI_LINE_TEXT":case "MULTI_SELECT":case "RADIO_BUTTON":case "RICH_TEXT":case "SINGLE_LINE_TEXT":p[h]=d.fieldInfos.parallelize[h]}return p},{});Object.keys(m.fields).length!=
0?n.build(p=>{(h=>{h.elm(".kb-attachment-search-operation")||(l=>{h.addClass("kb-scope").attr("form-id","form_"+l.id).append(kb.create("div").addClass("kb-attachment-search-operation"+(d.mobile?" kb-mobile":"")).append(kb.field.activate((k=>{k.elm("select").empty().assignOption([{code:"",label:"All"}].concat(Object.values(m.fields).map(a=>({code:a.code,label:a.label}))),"label","code");return k})(kb.field.create(l.fields.target).addClass("kb-target")),l)).append(kb.field.activate(kb.field.create(l.fields.keyword).addClass("kb-keyword"),
l)).append(kb.create("button").addClass("kb-icon kb-icon-lookup").on("click",k=>{n.search(p)})).append(kb.create("button").addClass("kb-icon kb-icon-del").on("click",k=>{k.currentTarget.parentNode.elm(".kb-keyword").elm("input").val("");n.search(p)})));kb.record.set(h,l,(k=>{var a={};"keyword"in k&&(a.keyword={value:k.keyword});"target"in k&&(a.target={value:k.target});return a})(kb.queries()));kb.event.on("kb.change.keyword",k=>{k.container==h&&n.search(p);return k})})({id:"AttachmentSearch",fields:{target:{code:"target",
type:"DROP_DOWN",label:"",required:!1,noLabel:!0,options:[{index:0,label:"open"},{index:1,label:"close"}]},keyword:{code:"keyword",type:"SINGLE_LINE_TEXT",label:"",required:!1,noLabel:!0,placeholder:""}}})})(d.mobile?kintone.mobile.app.getHeaderSpaceElement():kintone.app.getHeaderMenuSpaceElement());q(b)}):q(b)})(D.list.reduce((m,g)=>{g.id==b.viewId.toString()&&(m=g);return m},{fields:Object.values(d.fieldInfos.parallelize).reduce((m,g)=>{g.tableCode||m.push(g.code);return m},[]),filterCond:""}))})}):
q(b)};"useBulkUpdate"in u||(kb.alert(kb.error.config.update("Boost! Attachment")),u.useBulkUpdate={value:[]});u.useBulkUpdate.value.includes("use")&&b.viewType=="list"?kb.filter.auth(u.permitUser.value,u.permitOrganization.value,u.permitGroup.value).then(D=>{D&&kb.icon.create(d.mobile,d.type,"kb-attachment-button","refresh",()=>{kb.record.builder.build(Object.values(d.fieldInfos.placed).reduce((m,g)=>{d.fieldInfos.disables.includes(g.code)||g.tableCode||(m[g.code]=g);return m},{}),null,m=>{kb.view.records.get(d.app.id,
(d.mobile?kintone.mobile.app:kintone.app).getQueryCondition()).then(g=>{g.length!=0?kb.confirm(kb.constants.common.message.confirm.submit[kb.operator.language],()=>{kb.view.records.set(d.app.id,{put:g.map(n=>({id:n.$id.value,record:kb.extend({},m)}))}).then(n=>kb.alert("Done!",()=>window.location.reload(!0))).catch(n=>kb.alert(kb.error.parse(n)))}):kb.alert("There are no records.")}).catch(g=>kb.alert(kb.error.parse(g)))})});C()}).catch(D=>C()):C()})(JSON.parse(y.flat))}catch(u){kb.alert(kb.error.parse(u)),
q(b)}}).catch(v=>q(b)):q(b)}).catch(y=>q(b))})(b.type.split(".").first()=="mobile",b.type.split(".").slice(-2).first())}));kintone.events.on(["app.report.show","mobile.app.report.show"],b=>new Promise((q,F)=>{((A,B)=>{d.mobile=A;d.type=B;kb.config[E].config.get().then(y=>{if(Object.keys(y).length!=0)try{var v=JSON.parse(y.flat);"usePivotTranspose"in v||(kb.alert(kb.error.config.update("Boost! Attachment")),v.usePivotTranspose={value:[]});v.usePivotTranspose.value.includes("use")&&(kb.elm(".kb-pivottranspose-style")||
kb.elm("head").append(kb.create("style").addClass("kb-pivottranspose-style").attr("media","screen").attr("type","text/css").text("\n.gaia-report-crosstable{\n\tborder:1px solid #e3e7e8;\n\tborder-collapse:collapse;\n\tborder-spacing:0;\n\twriting-mode:vertical-lr;\n}\n.gaia-report-crosstable :is(colgroup,tr){\n\tbackground-color:transparent !important;\n\tborder:none !important;\n}\n.gaia-report-crosstable tr :is(td,th){\n\tborder:1px solid #e3e7e8;\n\twriting-mode:horizontal-tb;\n\twhite-space:nowrap;\n}\n.gaia-report-crosstable tr>td:first-child{\n\tbackground-color:transparent !important;\n}\n.gaia-report-crosstable .gaia-report-crosstable-row-group .gaia-report-crosstable-groupname{\n\tbackground-color:transparent !important;\n}\n.gaia-report-crosstable .gaia-report-crosstable-row-total .gaia-report-crosstable-groupname{\n\tbackground-color:transparent !important;\n}\n.gaia-report-crosstable .gaia-report-crosstable-row-subtotal .gaia-report-crosstable-groupvalue{\n\tbackground-color:transparent !important;\n}\n.gaia-report-crosstable:has(td[rowspan]) .gaia-report-crosstable-row-group>td:nth-child(2n+1){\n\tbackground-color:#f5f5f5;\n}\n.gaia-report-crosstable:has(td[rowspan]) .gaia-report-crosstable-row-total>td:nth-child(2n+1){\n\tbackground-color:#f5f5f5;\n}\n.gaia-report-crosstable:has(td[rowspan]) .gaia-report-crosstable-row-subtotal:has(td[rowspan])>td:nth-child(2n+1){\n\tbackground-color:#f5f5f5;\n}\n.gaia-report-crosstable:has(td[rowspan]) .gaia-report-crosstable-row-subtotal:not(:has(td[rowspan]))>td:nth-child(2n){\n\tbackground-color:#f5f5f5;\n}\n.gaia-report-crosstable:not(:has(td[rowspan])) .gaia-report-crosstable-row-group>td:nth-child(2n){\n\tbackground-color:#f5f5f5;\n}\n.gaia-report-crosstable:not(:has(td[rowspan])) .gaia-report-crosstable-row-total>td:nth-child(2n){\n\tbackground-color:#f5f5f5;\n}\n.gaia-report-crosstable:not(:has(td[rowspan])) .gaia-report-crosstable-row-subtotal>td:nth-child(2n){\n\tbackground-color:#f5f5f5;\n}\n")));
q(b)}catch(u){kb.alert(kb.error.parse(u)),q(b)}else q(b)}).catch(y=>q(b))})(b.type.split(".").first()=="mobile",b.type.split(".").slice(-2).first())}));kb.event.on("kb.attachment.call",b=>new Promise((q,F)=>{kb.config[E].config.get().then(A=>{if(Object.keys(A).length!=0)try{(B=>{switch(b.mode){case "download":b.downloadable=B.useAttachmentViewer.value.includes("use")?!B.onlyView.value.includes("onlyView"):!0;break;case "placeholder":B.usePlaceholder.value.includes("use")&&(y=>{B.placeholders.value.map(v=>
v.value).each((v,u)=>{v.field.value in y&&(u=y[v.field.value],u.tableCode?b.fields[u.tableCode].fields[u.code].placeholder=v.text.value:b.fields[u.code].placeholder=v.text.value)})})(kb.field.parallelize(b.fields))}q(b)})(JSON.parse(A.flat))}catch(B){kb.alert(kb.error.parse(B)),q(b)}else q(b)}).catch(A=>q(b))}))})(kintone.$PLUGIN_ID);