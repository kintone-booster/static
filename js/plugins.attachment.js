/*
* FileName "plugins.attachment.js"
* Version: 1.0.0
* Copyright (c) 2023 Pandafirm LLC
* Distributed under the terms of the GNU Lesser General Public License.
* https://opensource.org/licenses/LGPL-2.1
*/
'use strict';(F=>{var c={observers:[]},I=d=>{var p={};if(d.useMultiline.value.includes("use")&&!c.mobile)for(var G in c.fieldInfos.tables)(B=>{var C=Object.keys(B.fields).filter(r=>d.multilines.value.map(x=>x.value.field.value).includes(r));C.length!=0&&(p[B.id]={tableInfo:B,lines:Object.keys(B.fields).reduce((r,x)=>{C.includes(x)&&r.last().length!=0&&r.push([]);r.last().push(c.fieldInfos.parallelize[x].id);return r},[[]])})})(c.fieldInfos.tables[G]);return[d,p]},J=(d,p,G)=>{(B=>{B.observe(kb.elm(".subtable-"+
d.id),{childList:!0,subtree:!0});kb.elms(".subtable-"+d.id+" tbody tr").length==p[d.code].value.length&&G.each((C,r)=>C({record:p}));c.observers.push(B)})(new MutationObserver(()=>{G.each((B,C)=>B({record:p}))}))};kintone.events.on(["app.record.create.show","app.record.edit.show","mobile.app.record.create.show","mobile.app.record.edit.show"],d=>new Promise((p,G)=>{((B,C)=>{c.mobile=B;c.type=C;c.observers.each((r,x)=>r.disconnect());c.observers=[];kb.config[F].config.get().then(r=>{Object.keys(r).length!=
0?kb.field.load(kb.config[F].app,!0).then(x=>{c.app={id:kb.config[F].app,fields:x.origin};c.fieldInfos=x;try{(([u,E])=>{var y={};u.useLookupNavi.value.includes("use")&&Object.values(c.fieldInfos.parallelize).filter(b=>b.lookup).each((b,z)=>{(k=>{if(b.tableCode){var h=c.fieldInfos.tables[b.tableCode];h.code in y||(y[h.code]=[]);y[h.code].push(k)}else k({record:d.record})})(k=>{(h=>{h&&(Array.isArray(h)?h:[h]).each((l,m)=>{l.value.parentNode.elm(".kb-attachment-lookup-operation")||l.value.parentNode.css({alignItems:"center"}).insertBefore(kb.create("button").addClass("kb-icon kb-icon-open kb-attachment-lookup-operation").on("click",
a=>{((n,e)=>{n?kb.view.records.get(e,kb.filter.query.create({code:b.lookup.relatedKeyField},"=",{type:b.type,value:n})).then(f=>{f.length!=0&&window.open(kb.record.page.detail(c.mobile,e,f.first().$id.value))}).catch(f=>kb.alert(kb.error.parse(f))):window.open(kb.record.page.add(c.mobile,e))})(l.value.elm("input[type=text]").val(),b.lookup.relatedApp.app)}),l.value.nextSibling)})})(kb.field.get(b,c.mobile,c.type))})});u.usePlaceholder.value.includes("use")&&u.placeholders.value.map(b=>b.value).each((b,
z)=>{b.field.value in c.fieldInfos.parallelize&&(k=>{(h=>{if(k.tableCode){var l=c.fieldInfos.tables[k.tableCode];l.code in y||(y[l.code]=[]);y[l.code].push(h)}else h({record:d.record})})(h=>{(l=>{l&&(Array.isArray(l)?l:[l]).each((m,a)=>{c.mobile?m.value.attr("placeholder",b.text.value):m.value.elm("input[type=text],textarea").attr("placeholder",b.text.value)})})(kb.field.get(k,c.mobile,c.type))})})(c.fieldInfos.parallelize[b.field.value])});u.useAlignTableButtons.value.includes("use")&&!c.mobile&&
Object.values(x.tables).filter(b=>!Object.keys(E).includes(b.id)).each((b,z)=>{((k,h)=>{d.record[k.code].value.length!=0&&((l=>{l.prepend(l.elm('[class^="subtable-operation-gaia"]'))})(h.addClass("kb-attachment-subtable-operation").elm("thead").elm("tr")),k.code in y||(y[k.code]=[]),y[k.code].push(l=>{h.elms("tbody tr").each((m,a)=>{Array.from(m.elms("td").last().classList).some(n=>n.startsWith("subtable-operation-gaia"))&&m.prepend(m.elm('[class^="subtable-operation-gaia"]'))})}))})(b,kb.elm(".subtable-"+
b.id))});if(u.useMultiline.value.includes("use")&&!c.mobile)for(var t in E)((b,z)=>{var k=(h,l,m)=>{var a=[];l&&l.elms("tr").each((n,e)=>{n.hasClass("kb-attachment-subtable-multi")||(f=>{u.useAlignTableButtons.value.includes("use")?n.addClass("kb-attachment-subtable-multi").append(f):n.addClass("kb-attachment-subtable-multi").prepend(f);h.lines.each((q,v)=>{f.append((w=>{q.each((g,A)=>{var D={};m?g?w.append(n.elm(".label-"+g).addClass("kb-attachment-subtable-multi-cell").css(D)):w.append(kb.create("th").addClass("subtable-label-gaia kb-attachment-subtable-multi-cell").css(D)):
(D.width=z.elm("thead").elm(".label-"+g).css("width"),g?w.append(n.elm(".field-"+g).closest("td").addClass("kb-attachment-subtable-multi-cell").css(D)):w.append(kb.create("td").addClass("kb-attachment-subtable-multi-cell").css(D)));A==q.length-1&&a.push(w.lastElementChild)});return w})(kb.create("div").css({alignItems:"stretch",display:"flex"})))})})(m?kb.create("th").addClass("subtable-label-gaia"):kb.create("td"))});m||a.each((n,e)=>n.css({flex:"1"}))};d.record[b.tableInfo.code].value.length!=0&&
(u.useAlignTableButtons.value.includes("use")&&z.addClass("kb-attachment-subtable-operation"),k(b,z.elm("thead"),!0),b.tableInfo.code in y||(y[b.tableInfo.code]=[]),y[b.tableInfo.code].push(h=>{k(b,z.elm("tbody"),!1)}))})(E[t],kb.elm(".subtable-"+E[t].tableInfo.id));for(t in y)J(c.fieldInfos.tables[t],d.record,y[t])})(I(JSON.parse(r.flat))),p(d)}catch(u){kb.alert(kb.error.parse(u)),p(d)}}).catch(x=>p(d)):p(d)}).catch(r=>p(d))})(d.type.split(".").first()=="mobile",d.type.split(".").slice(-2).first())}));
kintone.events.on(["app.record.detail.show","mobile.app.record.detail.show"],d=>new Promise((p,G)=>{((B,C)=>{c.mobile=B;c.type=C;c.observers.each((r,x)=>r.disconnect());c.observers=[];kb.config[F].config.get().then(r=>{Object.keys(r).length!=0?kb.field.load(kb.config[F].app,!0).then(x=>{c.app={id:kb.config[F].app,fields:x.origin};c.fieldInfos=x;try{(([u,E])=>{var y={};u.useAttachmentViewer.value.includes("use")&&Object.values(c.fieldInfos.parallelize).filter(b=>b.type=="FILE").each((b,z)=>{(k=>{if(b.tableCode){var h=
c.fieldInfos.tables[b.tableCode];h.code in y||(y[h.code]=[]);y[h.code].push(k)}else k({record:d.record})})(k=>{(h=>{h&&(Array.isArray(h)?h:[h]).each((l,m)=>{(a=>{(c.mobile?kb.children(l.value):l.value.elm("ul").elms("li")).each((n,e)=>{n.elm("a")&&!n.elm(".kb-attachment-file-operation")&&(f=>{f.length!=0&&(n.prepend(kb.create("span").addClass("kb-attachment-file-operation").html(f.first().name).on("click",q=>kb.attachment.show(f.first(),!u.onlyView.value.includes("onlyView")))),a=a.filter(q=>q!=f.first()))})(a.filter(f=>
f.name==n.elm("a").html()))})})(b.tableCode?k.record[b.tableCode].value[m].value[b.code].value:k.record[b.code].value)})})(kb.field.get(b,c.mobile,c.type))})});if(u.useMultiline.value.includes("use")&&!c.mobile)for(var t in E)((b,z)=>{var k=(h,l,m)=>{var a=[];l&&l.elms("tr").each((n,e)=>{n.hasClass("kb-attachment-subtable-multi")||(f=>{n.addClass("kb-attachment-subtable-multi").prepend(f);h.lines.each((q,v)=>{f.append((w=>{q.each((g,A)=>{var D={};m?g?w.append(n.elm(".label-"+g).addClass("kb-attachment-subtable-multi-cell").css(D)):
w.append(kb.create("th").addClass("subtable-label-gaia kb-attachment-subtable-multi-cell").css(D)):(D.width=z.elm("thead").elm(".label-"+g).css("width"),g?w.append(n.elm(".field-"+g).closest("td").addClass("kb-attachment-subtable-multi-cell").css(D)):w.append(kb.create("td").addClass("kb-attachment-subtable-multi-cell").css(D)));A==q.length-1&&a.push(w.lastElementChild)});return w})(kb.create("div").css({alignItems:"stretch",display:"flex"})))})})(m?kb.create("th").addClass("subtable-label-gaia"):
kb.create("td"))});m||a.each((n,e)=>n.css({flex:"1"}))};d.record[b.tableInfo.code].value.length!=0&&(k(b,z.elm("thead"),!0),b.tableInfo.code in y||(y[b.tableInfo.code]=[]),y[b.tableInfo.code].push(h=>{k(b,z.elm("tbody"),!1)}))})(E[t],kb.elm(".subtable-"+E[t].tableInfo.id));for(t in y)J(c.fieldInfos.tables[t],d.record,y[t])})(I(JSON.parse(r.flat))),p(d)}catch(u){kb.alert(kb.error.parse(u)),p(d)}}).catch(x=>p(d)):p(d)}).catch(r=>p(d))})(d.type.split(".").first()=="mobile",d.type.split(".").slice(-2).first())}));
kintone.events.on(["app.record.index.show","mobile.app.record.index.show"],d=>new Promise((p,G)=>{((B,C)=>{c.mobile=B;c.type=C;c.observers.each((r,x)=>r.disconnect());c.observers=[];kb.config[F].config.get().then(r=>{Object.keys(r).length!=0?kb.field.load(kb.config[F].app,!0).then(x=>{c.app={id:kb.config[F].app,fields:x.origin};c.fieldInfos=x;try{(u=>{var E=()=>{u.useSearchBox.value.includes("use")&&d.viewType=="list"?kb.view.load(c.app.id).then(y=>{(t=>{kb.roleSet.user.length==0?kb.roleSet.load().then(()=>
t()):t()})(()=>{(t=>{var b=(()=>{var k={},h={},l=(a=>Object.keys(a).reduce((n,e)=>{a[e]!="NONE"&&n.push(e);return n},[]))(cybozu.data.page.FIELD_ACCESSIBILITY||cybozu.data.page.FIELD_ACCESS_CONTROL.right.fields),m=a=>{var n={CREATED_AT:"CREATED_TIME",DECIMAL:"NUMBER",EDITOR:"RICH_TEXT",MODIFIED_AT:"UPDATED_TIME",MULTIPLE_CHECK:"CHECK_BOX",MULTIPLE_SELECT:"MULTI_SELECT",MULTIPLE_LINE_TEXT:"MULTI_LINE_TEXT",RECORD_ID:"RECORD_NUMBER",SINGLE_CHECK:"RADIO_BUTTON",SINGLE_SELECT:"DROP_DOWN"};return a in
n?n[a]:a};Object.values(cybozu.data.page.FORM_DATA.schema.table.fieldList).each((a,n)=>{if(l.includes(a.id))if(a.type=="REFERENCE_TABLE")h[a.id]=a.var;else switch(k[a.var]={id:"f"+a.id,type:m(a.type)},k[a.var].type){case "CHECK_BOX":case "DROP_DOWN":case "MULTI_SELECT":case "RADIO_BUTTON":k[a.var].option=(()=>{var e={};"options"in a.properties&&Array.isArray(a.properties.options)&&a.properties.options.each((f,q)=>{f.valid&&(e[f.label]=f.id)});return e})();break;case "STATUS":k[a.var].status=(()=>
{var e={};(f=>{(typeof f.useStatus==="string"?f.useStatus=="true":f.useStatus)&&f.states.each((q,v)=>{q.valid&&(e[q.label]=q.id)})})(cybozu.data.page.STATUS_DATA);return e})()}});Object.values(cybozu.data.page.FORM_DATA.schema.subTable).map(a=>Object.values(a.fieldList)).flat().each((a,n)=>{if(l.includes(a.id))switch(k[a.var]={id:"f"+a.id,type:m(a.type)},k[a.var].type){case "CHECK_BOX":case "DROP_DOWN":case "MULTI_SELECT":case "RADIO_BUTTON":k[a.var].option=(()=>{var e={};"options"in a.properties&&
Array.isArray(a.properties.options)&&a.properties.options.each((f,q)=>{f.valid&&(e[f.label]=f.id)});return e})()}});cybozu.data.page.FORM_DATA.referenceTables.each((a,n)=>{a.masterApp.schema&&l.includes(a.fieldId)&&((e,f,q)=>{Object.values(a.masterApp.schema.table.fieldList).each((v,w)=>{if(!e.includes(v.id))switch(k[h[f]+"."+v.var]={id:"f"+f+".f"+v.id,type:m(v.type)},k[h[f]+"."+v.var].type){case "CHECK_BOX":case "DROP_DOWN":case "MULTI_SELECT":case "RADIO_BUTTON":k[h[f]+"."+v.var].option=(()=>{var g=
{};"options"in v.properties&&Array.isArray(v.properties.options)&&v.properties.options.each((A,D)=>{A.valid&&(g[A.label]=A.id)});return g})();break;case "STATUS":k[h[f]+"."+v.var].status=(()=>{var g={};(typeof q.useStatus==="string"?q.useStatus=="true":q.useStatus)&&q.states.each((A,D)=>{A.valid&&(g[A.label]=A.id)});return g})()}})})(a.masterApp.unAccessibleFieldIds,a.fieldId,a.masterApp.status)});return k})(),z={build:k=>{var h=t.filterCond.match(/ and /g)?" and ":" or ",l=t.filterCond.split(h).filter(a=>
a),m=(a,n)=>{l.length!=0?(e=>{if(e.info){var f=RegExp("[/\\\\^$*+?.()|[\\]{}]","g"),q=function(w){var g={groups:[],organizations:[],users:[]},A="";w.match(/ in /g)&&(D=>{D.each((H,K)=>{if(H.replace(/^[ ]+/g,"").replace(/[ ]+$/g,"").match(/^"/g))switch(H=H.replace(/^[ "]+/g,"").replace(/[ "]+$/g,""),H){case "GROUP":A="groups";break;case "ORGANIZATION":A="organizations";break;case "USER":A="users";break;default:A||="users",g[A].push(H)}})})(w.split(" in ").last().replace(/^\(/g,"").replace(/\)$/g,"").split(","));
return g};switch(e.info.type){case "CHECK_BOX":case "DROP_DOWN":case "MULTI_SELECT":case "RADIO_BUTTON":for(var v in e.info.option)e.query.match(new RegExp('"'+v.replace(f,"\\$&")+'"'))&&(e.query=e.query.replace(new RegExp('"'+v.replace(f,"\\$&")+'"'),'"'+e.info.option[v]+'"'));break;case "CREATOR":case "MODIFIER":case "USER_SELECT":(w=>{kb.roleSet.group.filter(g=>w.groups.includes(g.code.value)).each((g,A)=>{e.query.match(new RegExp('"'+g.code.value.replace(f,"\\$&")+'"'))&&(e.query=e.query.replace(new RegExp('"'+
g.code.value.replace(f,"\\$&")+'"'),'"'+g.info.id+'"'))});kb.roleSet.organization.filter(g=>w.organizations.includes(g.code.value)).each((g,A)=>{e.query.match(new RegExp('"'+g.code.value.replace(f,"\\$&")+'"'))&&(e.query=e.query.replace(new RegExp('"'+g.code.value.replace(f,"\\$&")+'"'),'"'+g.info.id+'"'))});kb.roleSet.user.filter(g=>w.users.includes(g.code.value)).each((g,A)=>{e.query.match(new RegExp('"'+g.code.value.replace(f,"\\$&")+'"'))&&(e.query=e.query.replace(new RegExp('"'+g.code.value.replace(f,
"\\$&")+'"'),'"'+g.info.id+'"'))})})(q(e.query));break;case "GROUP_SELECT":(w=>{kb.roleSet.group.filter(g=>w.groups.includes(g.code.value)).each((g,A)=>{e.query.match(new RegExp('"'+g.code.value.replace(f,"\\$&")+'"'))&&(e.query=e.query.replace(new RegExp('"'+g.code.value.replace(f,"\\$&")+'"'),'"'+g.info.id+'"'))})})(q(e.query));break;case "ORGANIZATION_SELECT":(w=>{kb.roleSet.organization.filter(g=>w.organizations.includes(g.code.value)).each((g,A)=>{e.query.match(new RegExp('"'+g.code.value.replace(f,
"\\$&")+'"'))&&(e.query=e.query.replace(new RegExp('"'+g.code.value.replace(f,"\\$&")+'"'),'"'+g.info.id+'"'))})})(q(e.query));break;case "STATUS":for(v in e.info.status)e.query.match(new RegExp('"'+v.replace(f,"\\$&")+'"'))&&(e.query=e.query.replace(new RegExp('"'+v.replace(f,"\\$&")+'"'),'"'+e.info.status[v]+'"'))}l[a]=e.query}else l[a]="";a++;a<l.length?m(a,n):n(l.filter(w=>w).join(h))})((e=>{var f={info:null,query:""};e.length>1&&e.last()in b&&(f.info=b[e.last()],f.query=l[a].replace(new RegExp(e.last().replace(/[\/\\^$*+?.()|\[\]{}]/g,
"\\$&")),f.info.id));return f})(l[a].match(/^([^ ]+)/))):n("")};m(0,a=>{k(a)})},search:k=>{var h=kb.elm(".kb-attachment-search-operation").elm(".kb-keyword").elm("input"),l=kb.elm(".kb-attachment-search-operation").elm(".kb-target").elm("select"),m=kintone.api.url("/k/",!0).replace(/\.json/g,"")+(c.mobile?"m/"+c.app.id:c.app.id)+"/?view="+d.viewId.toString();if(h.val()){var a=(n=>{var e=(l.val()?[t.fields[l.val()]]:Object.values(t.fields)).reduce((f,q)=>{f.push(n.map(v=>{var w=v.match(/^!/g);v=v.replace(/^!/g,
"");var g="";if(v=="EMPTY")switch(q.type){case "CHECK_BOX":case "DROP_DOWN":case "MULTI_SELECT":case "RADIO_BUTTON":case "STATUS":g=b[q.code].id+(w?" not":"")+' in ("")';break;case "FILE":case "LINK":case "MULTI_LINE_TEXT":case "RICH_TEXT":case "SINGLE_LINE_TEXT":g=b[q.code].id+(w?" !":" ")+'= ""'}else switch(q.type){case "CHECK_BOX":case "DROP_DOWN":case "MULTI_SELECT":case "RADIO_BUTTON":v in b[q.code].option&&(g=b[q.code].id+(w?" not":"")+' in ("'+b[q.code].option[v].replace(/"/g,'\\"')+'")');
break;case "FILE":case "LINK":case "MULTI_LINE_TEXT":case "RICH_TEXT":case "SINGLE_LINE_TEXT":g=b[q.code].id+(w?" not":"")+' like "'+v.replace(/"/g,'\\"')+'"';break;case "STATUS":v in b[q.code].status&&(g=b[q.code].id+(w?" not":"")+' in ("'+b[q.code].status[v].replace(/"/g,'\\"')+'")')}return g}).join(" or "));return f.filter(v=>v)},[]).map(f=>"("+f+")");return k?["("+k+")"].concat(e.join(" or ")).join(" and "):e.join(" or ")})(h.val().split(/[ \u3000]/).filter(n=>n));window.location.href=a?m+"&keyword="+
h.val()+"&target="+l.val()+"&q="+encodeURIComponent(a):m}else window.location.href=m}};t.fields=t.fields.reduce((k,h)=>{if(h in b)switch(c.fieldInfos.parallelize[h].type){case "CHECK_BOX":case "DROP_DOWN":case "FILE":case "LINK":case "MULTI_LINE_TEXT":case "MULTI_SELECT":case "RADIO_BUTTON":case "RICH_TEXT":case "SINGLE_LINE_TEXT":k[h]=c.fieldInfos.parallelize[h]}return k},{});Object.keys(t.fields).length!=0?z.build(k=>{(h=>{h.elm(".kb-attachment-search-operation")||(l=>{h.addClass("kb-scope").attr("form-id",
"form_"+l.id).append(kb.create("div").addClass("kb-attachment-search-operation"+(c.mobile?" kb-mobile":"")).append(kb.field.activate((m=>{m.elm("select").empty().assignOption([{code:"",label:"All"}].concat(Object.values(t.fields).map(a=>({code:a.code,label:a.label}))),"label","code");return m})(kb.field.create(l.fields.target).addClass("kb-target")),l)).append(kb.field.activate(kb.field.create(l.fields.keyword).addClass("kb-keyword"),l)).append(kb.create("button").addClass("kb-icon kb-icon-lookup").on("click",
m=>{z.search(k)})).append(kb.create("button").addClass("kb-icon kb-icon-del").on("click",m=>{m.currentTarget.parentNode.elm(".kb-keyword").elm("input").val("");z.search(k)})));kb.record.set(h,l,(m=>{var a={};"keyword"in m&&(a.keyword={value:m.keyword});"target"in m&&(a.target={value:m.target});return a})(kb.queries()));kb.event.on("kb.change.keyword",m=>{m.container==h&&z.search(k);return m})})({id:"AttachmentSearch",fields:{target:{code:"target",type:"DROP_DOWN",label:"",required:!1,noLabel:!0,options:[{index:0,
label:"open"},{index:1,label:"close"}]},keyword:{code:"keyword",type:"SINGLE_LINE_TEXT",label:"",required:!1,noLabel:!0,placeholder:""}}})})(c.mobile?kintone.mobile.app.getHeaderSpaceElement():kintone.app.getHeaderMenuSpaceElement());p(d)}):p(d)})(y.list.reduce((t,b)=>{b.id==d.viewId.toString()&&(t=b);return t},{fields:Object.values(c.fieldInfos.parallelize).reduce((t,b)=>{b.tableCode||t.push(b.code);return t},[]),filterCond:""}))})}):p(d)};"useBulkUpdate"in u||(kb.alert(kb.error.config.update("Boost! Attachment")),
u.useBulkUpdate={value:[]});u.useBulkUpdate.value.includes("use")&&d.viewType=="list"?kb.filter.auth(u.permitUser.value,u.permitOrganization.value,u.permitGroup.value).then(y=>{y&&kb.icon.create(c.mobile,c.type,"kb-attachment-button","refresh",()=>{kb.record.builder.build(Object.values(c.fieldInfos.placed).reduce((t,b)=>{c.fieldInfos.disables.includes(b.code)||b.tableCode||(t[b.code]=b);return t},{}),null,t=>{kb.view.records.get(c.app.id,(c.mobile?kintone.mobile.app:kintone.app).getQueryCondition()).then(b=>
{b.length!=0?kb.confirm(kb.constants.common.message.confirm.submit[kb.operator.language],()=>{kb.view.records.set(c.app.id,{put:b.map(z=>({id:z.$id.value,record:kb.extend({},t)}))}).then(z=>kb.alert("Done!",()=>window.location.reload(!0))).catch(z=>kb.alert(kb.error.parse(z)))}):kb.alert("There are no records.")}).catch(b=>kb.alert(kb.error.parse(b)))})});E()}).catch(y=>E()):E()})(JSON.parse(r.flat))}catch(u){kb.alert(kb.error.parse(u)),p(d)}}).catch(x=>p(d)):p(d)}).catch(r=>p(d))})(d.type.split(".").first()==
"mobile",d.type.split(".").slice(-2).first())}));kintone.events.on(["app.report.show","mobile.app.report.show"],d=>new Promise((p,G)=>{((B,C)=>{c.mobile=B;c.type=C;c.observers.each((r,x)=>r.disconnect());c.observers=[];kb.config[F].config.get().then(r=>{if(Object.keys(r).length!=0)try{var x=JSON.parse(r.flat);"usePivotTranspose"in x||(kb.alert(kb.error.config.update("Boost! Attachment")),x.usePivotTranspose={value:[]});x.usePivotTranspose.value.includes("use")&&(kb.elm(".kb-pivottranspose-style")||
kb.elm("head").append(kb.create("style").addClass("kb-pivottranspose-style").attr("media","screen").attr("type","text/css").text("\n.gaia-report-crosstable{\n\tborder:1px solid #e3e7e8;\n\tborder-collapse:collapse;\n\tborder-spacing:0;\n\twriting-mode:vertical-lr;\n}\n.gaia-report-crosstable :is(colgroup,tr){\n\tbackground-color:transparent !important;\n\tborder:none !important;\n}\n.gaia-report-crosstable tr :is(td,th){\n\tborder:1px solid #e3e7e8;\n\twriting-mode:horizontal-tb;\n\twhite-space:nowrap;\n}\n.gaia-report-crosstable tr>td:first-child{\n\tbackground-color:transparent !important;\n}\n.gaia-report-crosstable .gaia-report-crosstable-row-group .gaia-report-crosstable-groupname{\n\tbackground-color:transparent !important;\n}\n.gaia-report-crosstable .gaia-report-crosstable-row-total .gaia-report-crosstable-groupname{\n\tbackground-color:transparent !important;\n}\n.gaia-report-crosstable .gaia-report-crosstable-row-subtotal .gaia-report-crosstable-groupvalue{\n\tbackground-color:transparent !important;\n}\n.gaia-report-crosstable:has(td[rowspan]) .gaia-report-crosstable-row-group>td:nth-child(2n+1){\n\tbackground-color:#f5f5f5;\n}\n.gaia-report-crosstable:has(td[rowspan]) .gaia-report-crosstable-row-total>td:nth-child(2n+1){\n\tbackground-color:#f5f5f5;\n}\n.gaia-report-crosstable:has(td[rowspan]) .gaia-report-crosstable-row-subtotal:has(td[rowspan])>td:nth-child(2n+1){\n\tbackground-color:#f5f5f5;\n}\n.gaia-report-crosstable:has(td[rowspan]) .gaia-report-crosstable-row-subtotal:not(:has(td[rowspan]))>td:nth-child(2n){\n\tbackground-color:#f5f5f5;\n}\n.gaia-report-crosstable:not(:has(td[rowspan])) .gaia-report-crosstable-row-group>td:nth-child(2n){\n\tbackground-color:#f5f5f5;\n}\n.gaia-report-crosstable:not(:has(td[rowspan])) .gaia-report-crosstable-row-total>td:nth-child(2n){\n\tbackground-color:#f5f5f5;\n}\n.gaia-report-crosstable:not(:has(td[rowspan])) .gaia-report-crosstable-row-subtotal>td:nth-child(2n){\n\tbackground-color:#f5f5f5;\n}\n")));
p(d)}catch(u){kb.alert(kb.error.parse(u)),p(d)}else p(d)}).catch(r=>p(d))})(d.type.split(".").first()=="mobile",d.type.split(".").slice(-2).first())}));kb.event.on("kb.attachment.call",d=>new Promise((p,G)=>{kb.config[F].config.get().then(B=>{if(Object.keys(B).length!=0)try{(C=>{switch(d.mode){case "download":d.downloadable=C.useAttachmentViewer.value.includes("use")?!C.onlyView.value.includes("onlyView"):!0;break;case "placeholder":C.usePlaceholder.value.includes("use")&&(r=>{C.placeholders.value.map(x=>
x.value).each((x,u)=>{x.field.value in r&&(u=r[x.field.value],u.tableCode?d.fields[u.tableCode].fields[u.code].placeholder=x.text.value:d.fields[u.code].placeholder=x.text.value)})})(kb.field.parallelize(d.fields))}p(d)})(JSON.parse(B.flat))}catch(C){kb.alert(kb.error.parse(C)),p(d)}else p(d)}).catch(B=>p(d))}))})(kintone.$PLUGIN_ID);