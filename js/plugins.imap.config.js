/*
* FileName "plugins.imap.config.js"
* Version: 1.0.0
* Copyright (c) 2023 Pandafirm LLC
* Distributed under the terms of the GNU Lesser General Public License.
* https://opensource.org/licenses/LGPL-2.1
*/
'use strict';(f=>{var g={};kb.field.load(kintone.app.getId()).then(k=>{kb.view.load(kintone.app.getId()).then(m=>{kb.config[f].build({submit:(l,h)=>{try{var e=!1;h.tab=[];h.flat={};(a=>{kb.config[f].tabbed.tabs.some(b=>{var c=kb.record.get(b.panel,a);c.error?(kb.alert(kb.constants.common.message.invalid.record[kb.operator.language]),kb.config[f].tabbed.activate(b),e=!0):h.tab.push({label:b.label.html(),setting:c.record});return e})})({id:g.app.id,fields:g.app.fields.tab});h.tab=JSON.stringify(h.tab);
h.flat=JSON.stringify(h.flat);return e?!1:h}catch(a){return kb.alert(kb.error.parse(a)),!1}}},(l,h)=>{try{g.app={id:f,fields:{tab:{label:{code:"label",type:"SINGLE_LINE_TEXT",label:kb.constants.config.caption.label[kb.operator.language],required:!0,noLabel:!1,placeholder:""},message:{code:"message",type:"SINGLE_LINE_TEXT",label:kb.constants.config.caption.message[kb.operator.language],required:!0,noLabel:!1,placeholder:""},view:{code:"view",type:"DROP_DOWN",label:kb.constants.config.caption.view[kb.operator.language],
required:!1,noLabel:!1,options:[]},host:{code:"host",type:"SINGLE_LINE_TEXT",label:kb.constants.config.caption.host[kb.operator.language],required:!0,noLabel:!1,format:"alphanum"},port:{code:"port",type:"NUMBER",label:kb.constants.config.caption.port[kb.operator.language],required:!0,noLabel:!1},option:{code:"option",type:"SINGLE_LINE_TEXT",label:kb.constants.config.caption.option[kb.operator.language],required:!1,noLabel:!1,placeholder:"/imap/ssl",format:"alphanum"},mailbox:{code:"mailbox",type:"SINGLE_LINE_TEXT",
label:kb.constants.config.caption.mailbox[kb.operator.language],required:!1,noLabel:!1,placeholder:"INBOX",format:"alphanum"},author:{code:"author",type:"SINGLE_LINE_TEXT",label:kb.constants.config.caption.author[kb.operator.language],required:!0,noLabel:!1,format:"alphanum"},pwd:{code:"pwd",type:"SINGLE_LINE_TEXT",label:kb.constants.config.caption.pwd[kb.operator.language],required:!0,noLabel:!1,format:"password"},uid:{code:"uid",type:"DROP_DOWN",label:kb.constants.config.caption.uid[kb.operator.language],
required:!0,noLabel:!1,options:[]},from:{code:"from",type:"DROP_DOWN",label:kb.constants.config.caption.from[kb.operator.language],required:!0,noLabel:!1,options:[]},date:{code:"date",type:"DROP_DOWN",label:kb.constants.config.caption.date[kb.operator.language],required:!0,noLabel:!1,options:[]},subject:{code:"subject",type:"DROP_DOWN",label:kb.constants.config.caption.subject[kb.operator.language],required:!0,noLabel:!1,options:[]},body:{code:"body",type:"DROP_DOWN",label:kb.constants.config.caption.body[kb.operator.language],
required:!0,noLabel:!1,options:[]},attachment:{code:"attachment",type:"DROP_DOWN",label:kb.constants.config.caption.attachment[kb.operator.language],required:!0,noLabel:!1,options:[]}},flat:{}}},(e=>{for(var a in e)g.app.fields.tab[a]=e[a]})(kb.config[f].ui.fields.conditions.get(k)),(e=>{for(var a in e)g.app.fields.tab[a]=e[a]})(kb.config[f].ui.fields.users.get(k)),kb.config[f].tabbed=new KintoneBoosterConfigTabbed(l,{add:e=>{(a=>{e.panel.addClass("kb-scope").attr("form-id","form_"+a.id).append(kb.config[f].ui.fields.users.set(kb.config[f].ui.fields.conditions.set(kb.create("div").addClass("kb-config-tabbed-panel-block"),
a,!0),a).append(kb.create("h1").html(kb.constants.config.caption.button[kb.operator.language])).append(kb.create("section").append(kb.field.activate(kb.field.create(a.fields.label).css({width:"100%"}),a))).append(kb.create("section").append(kb.field.activate(kb.field.create(a.fields.message).css({width:"100%"}),a))).append(kb.create("section").append(kb.field.activate((b=>{b.elm("select").empty().assignOption([{code:"",label:kb.constants.config.caption.view.all[kb.operator.language]}].concat(m.list.map(c=>
({code:c.id,label:c.name}))),"label","code");return b})(kb.field.create(a.fields.view)),a)))).append(kb.create("h1").html(kb.constants.config.caption.server[kb.operator.language])).append(kb.create("section").append(kb.create("div").append(kb.field.activate(kb.field.create(a.fields.host),a))).append(kb.create("p").addClass("kb-caution").html(kb.constants.config.description.host[kb.operator.language])).append(kb.create("div").append(kb.field.activate(kb.field.create(a.fields.port),a))).append(kb.create("div").append(kb.field.activate(kb.field.create(a.fields.option),
a))).append(kb.create("p").addClass("kb-caution").html(kb.constants.config.description.option[kb.operator.language])).append(kb.create("div").append(kb.field.activate(kb.field.create(a.fields.mailbox),a))).append(kb.create("p").addClass("kb-caution").html(kb.constants.config.description.mailbox[kb.operator.language])).append(kb.create("div").append(kb.field.activate(kb.field.create(a.fields.author),a))).append(kb.create("div").append(kb.field.activate(kb.field.create(a.fields.pwd),a)))).append(kb.create("h1").html(kb.constants.config.caption.receive[kb.operator.language])).append(kb.create("section").append(kb.create("div").append(kb.field.activate((b=>
{b.elm("select").empty().assignOption(kb.config[f].ui.options.fields(k,(c,d)=>{switch(d.type){case "SINGLE_LINE_TEXT":d.lookup||c.push({code:d.code,label:d.label})}return c}),"label","code");return b})(kb.field.create(a.fields.uid)),a))).append(kb.create("div").append(kb.field.activate((b=>{b.elm("select").empty().assignOption(kb.config[f].ui.options.fields(k,(c,d)=>{switch(d.type){case "LINK":"MAIL"==d.protocol&&c.push({code:d.code,label:d.label})}return c}),"label","code");return b})(kb.field.create(a.fields.from)),
a))).append(kb.create("div").append(kb.field.activate((b=>{b.elm("select").empty().assignOption(kb.config[f].ui.options.fields(k,(c,d)=>{switch(d.type){case "DATETIME":c.push({code:d.code,label:d.label})}return c}),"label","code");return b})(kb.field.create(a.fields.date)),a))).append(kb.create("div").append(kb.field.activate((b=>{b.elm("select").empty().assignOption(kb.config[f].ui.options.fields(k,(c,d)=>{switch(d.type){case "SINGLE_LINE_TEXT":d.lookup||c.push({code:d.code,label:d.label})}return c}),
"label","code");return b})(kb.field.create(a.fields.subject)),a))).append(kb.create("div").append(kb.field.activate((b=>{b.elm("select").empty().assignOption(kb.config[f].ui.options.fields(k,(c,d)=>{switch(d.type){case "MULTI_LINE_TEXT":case "RICH_TEXT":c.push({code:d.code,label:d.label})}return c}),"label","code");return b})(kb.field.create(a.fields.body)),a))).append(kb.create("div").append(kb.field.activate((b=>{b.elm("select").empty().assignOption(kb.config[f].ui.options.fields(k,(c,d)=>{switch(d.type){case "FILE":c.push({code:d.code,
label:d.label})}return c}),"label","code");return b})(kb.field.create(a.fields.attachment)),a))));e.panel.elms("input,select,textarea").each((b,c)=>b.initialize())})({id:g.app.id,fields:g.app.fields.tab})},copy:(e,a)=>{var b={id:g.app.id,fields:g.app.fields.tab};e=kb.record.get(e.panel,b,!0).record;kb.record.set(a.panel,b,e)},del:e=>{}}),0!=Object.keys(h).length?(e=>{e.each(a=>{var b={id:g.app.id,fields:g.app.fields.tab},c=kb.config[f].tabbed.add();kb.record.set(c.panel,b,a.setting);c.label.html(a.label)})})(JSON.parse(h.tab)):
kb.config[f].tabbed.add()}catch(e){kb.alert(kb.error.parse(e))}})})})})(kintone.$PLUGIN_ID);
kb.constants=kb.extend({config:{caption:{attachment:{en:"Attachment Field",ja:"\u6dfb\u4ed8\u30d5\u30a1\u30a4\u30eb\u30d5\u30a3\u30fc\u30eb\u30c9",zh:"\u9644\u4ef6\u5b57\u6bb5"},author:{en:"User Name",ja:"\u30e6\u30fc\u30b6\u30fc\u540d",zh:"\u7528\u6237\u540d"},body:{en:"Body",ja:"\u672c\u6587",zh:"\u6b63\u6587"},button:{en:"Execution Button Setting",ja:"\u5b9f\u884c\u30dc\u30bf\u30f3",zh:"\u6267\u884c\u6309\u94ae\u8bbe\u7f6e"},date:{en:"Received DateTime",ja:"\u53d7\u4fe1\u65e5\u6642",zh:"\u63a5\u6536\u65e5\u671f\u65f6\u95f4"},
from:{en:"Sender",ja:"\u5dee\u51fa\u4eba",zh:"\u53d1\u4ef6\u4eba"},host:{en:"Server Name",ja:"\u30b5\u30fc\u30d0\u30fc\u540d",zh:"\u670d\u52a1\u5668\u540d\u79f0"},label:{en:"Execution Button Label",ja:"\u5b9f\u884c\u30dc\u30bf\u30f3\u306e\u30e9\u30d9\u30eb\u30c6\u30ad\u30b9\u30c8",zh:"\u6267\u884c\u6309\u94ae\u7684\u6807\u7b7e\u540d\u79f0"},mailbox:{en:"Mailbox Name",ja:"\u30e1\u30fc\u30eb\u30dc\u30c3\u30af\u30b9\u540d",zh:"\u90ae\u7bb1\u540d\u79f0"},message:{en:"Execution Confirmation Dialog Message",
ja:"\u5b9f\u884c\u78ba\u8a8d\u30c0\u30a4\u30a2\u30ed\u30b0\u306e\u30e1\u30c3\u30bb\u30fc\u30b8",zh:"\u6267\u884c\u786e\u8ba4\u5bf9\u8bdd\u6846\u7684\u6d88\u606f"},option:{en:"Connection Options",ja:"\u63a5\u7d9a\u30aa\u30d7\u30b7\u30e7\u30f3",zh:"\u8fde\u63a5\u9009\u9879"},port:{en:"Port",ja:"\u30dd\u30fc\u30c8\u756a\u53f7",zh:"\u7aef\u53e3\u53f7"},pwd:{en:"Password",ja:"\u30d1\u30b9\u30ef\u30fc\u30c9",zh:"\u5bc6\u7801"},receive:{en:"Email Storage Settings",ja:"\u30e1\u30fc\u30eb\u4fdd\u5b58\u8a2d\u5b9a",
zh:"\u90ae\u4ef6\u4fdd\u5b58\u8bbe\u7f6e"},server:{en:"IMAP Server Settings",ja:"\u53d7\u4fe1IMAP\u30b5\u30fc\u30d0\u30fc\u8a2d\u5b9a",zh:"IMAP\u670d\u52a1\u5668\u8bbe\u7f6e"},subject:{en:"Subject",ja:"\u4ef6\u540d",zh:"\u4e3b\u9898"},uid:{en:"UID",ja:"\u30e1\u30fc\u30ebID",zh:"\u90ae\u7bb1ID"},view:{en:"List View where buttons can be placed",ja:"\u30dc\u30bf\u30f3\u3092\u6709\u52b9\u306b\u3059\u308b\u4e00\u89a7\u753b\u9762",zh:"\u53ef\u4ee5\u653e\u7f6e\u6309\u94ae\u7684\u5217\u8868\u89c6\u56fe",
all:{en:"No restrictions",ja:"\u5236\u9650\u3057\u306a\u3044",zh:"\u4e0d\u9650\u5236"}}},description:{host:{en:"If you encounter a connection error when entering a custom domain as the host name on a hosting server, please try using the initial domain provided by your service provider.<br>Additionally, since this is the host name of the IMAP server, please add a subdomain at the beginning if necessary. (e.g., imap.gmail.com, imap.mail.yahoo.com)",ja:"\u30db\u30b9\u30c6\u30a3\u30f3\u30b0\u30b5\u30fc\u30d0\u30fc\u3092\u3054\u5229\u7528\u3067\u3001\u72ec\u81ea\u30c9\u30e1\u30a4\u30f3\u3092\u30db\u30b9\u30c8\u540d\u306b\u5165\u529b\u3059\u308b\u3068\u63a5\u7d9a\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3059\u308b\u5834\u5408\u306f\u3001\u7ba1\u7406\u4f1a\u793e\u304b\u3089\u63d0\u4f9b\u3055\u308c\u305f\u521d\u671f\u30c9\u30e1\u30a4\u30f3\u3092\u304a\u8a66\u3057\u4e0b\u3055\u3044\u3002<br>\u307e\u305f\u3001IMAP\u30b5\u30fc\u30d0\u30fc\u306e\u30db\u30b9\u30c8\u540d\u306b\u306a\u308a\u307e\u3059\u306e\u3067\u3001\u5fc5\u8981\u306b\u5fdc\u3058\u3066\u5148\u982d\u306b\u30b5\u30d6\u30c9\u30e1\u30a4\u30f3\u3092\u8ffd\u52a0\u3057\u3066\u4e0b\u3055\u3044\u3002(\u4f8b: imap.gmail.com\u3001imap.mail.yahoo.com)",
zh:"\u5982\u679c\u60a8\u5728\u6258\u7ba1\u670d\u52a1\u5668\u4e0a\u5c06\u81ea\u5b9a\u4e49\u57df\u540d\u8f93\u5165\u4e3a\u4e3b\u673a\u540d\u65f6\u9047\u5230\u8fde\u63a5\u9519\u8bef\uff0c\u8bf7\u5c1d\u8bd5\u4f7f\u7528\u670d\u52a1\u63d0\u4f9b\u5546\u63d0\u4f9b\u7684\u521d\u59cb\u57df\u540d\u3002<br>\u6b64\u5916\uff0c\u7531\u4e8e\u8fd9\u662fIMAP\u670d\u52a1\u5668\u7684\u4e3b\u673a\u540d\uff0c\u8bf7\u6839\u636e\u9700\u8981\u5728\u5f00\u5934\u6dfb\u52a0\u5b50\u57df\u540d\u3002\uff08\u4f8b\u5982\uff1aimap.gmail.com\uff0cimap.mail.yahoo.com\uff09"},
mailbox:{en:'If not entered, "INBOX" will be used.',ja:"\u672a\u5165\u529b\u306e\u5834\u5408\u306f\u300cINBOX\u300d\u3092\u63a1\u7528\u3057\u307e\u3059\u3002",zh:"\u5982\u679c\u672a\u8f93\u5165\uff0c\u5c06\u4f7f\u7528\u201cINBOX\u201d\u3002"},option:{en:'If not entered, "/imap/ssl" will be used.',ja:"\u672a\u5165\u529b\u306e\u5834\u5408\u306f\u300c/imap/ssl\u300d\u3092\u63a1\u7528\u3057\u307e\u3059\u3002",zh:"\u5982\u679c\u672a\u8f93\u5165\uff0c\u5c06\u4f7f\u7528\u201c/imap/ssl\u201d\u3002"}}}},kb.constants);